{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/AI_Projects/bp-cleaning-app/src/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\n\n// Singleton pattern to prevent multiple Supabase instances\nlet supabaseInstance: ReturnType<typeof createBrowserClient> | null = null\n\nexport function createClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!supabaseUrl || !supabaseKey) {\n    // Return a mock client for build time\n    return {\n      auth: {\n        getUser: async () => ({ data: { user: null }, error: null }),\n        signInWithPassword: async () => ({ error: { message: 'Not configured' } }),\n        signUp: async () => ({ error: { message: 'Not configured' } }),\n        signOut: async () => {},\n        onAuthStateChange: () => ({ data: { subscription: { unsubscribe: () => {} } } })\n      },\n      from: () => ({\n        select: () => ({\n          eq: () => ({\n            order: () => ({ data: [], error: null }),\n            single: () => ({ data: null, error: null }),\n            lte: () => ({ data: [], error: null }),\n            gte: () => ({ data: [], error: null }),\n            limit: () => ({ data: [], error: null })\n          }),\n          order: () => ({ data: [], error: null }),\n          lte: () => ({ data: [], error: null }),\n          gte: () => ({ data: [], error: null })\n        }),\n        insert: () => ({ error: null }),\n        update: () => ({ error: null })\n      })\n    } as any\n  }\n\n  // Return existing instance if available (singleton)\n  if (supabaseInstance) {\n    return supabaseInstance\n  }\n\n  // Create new instance only once\n  supabaseInstance = createBrowserClient(supabaseUrl, supabaseKey)\n  return supabaseInstance\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,2DAA2D;AAC3D,IAAI,mBAAkE;AAE/D,SAAS;IACd,MAAM;IACN,MAAM;IAEN;;IA6BA,oDAAoD;IACpD,IAAI,kBAAkB;QACpB,OAAO;IACT;IAEA,gCAAgC;IAChC,mBAAmB,IAAA,iMAAmB,EAAC,aAAa;IACpD,OAAO;AACT"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///C:/AI_Projects/bp-cleaning-app/src/components/providers/auth-provider.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useEffect, useState, useRef } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport type { User } from '@supabase/supabase-js'\nimport type { Profile } from '@/lib/types'\n\ninterface AuthContextType {\n  user: User | null\n  profile: Profile | null\n  loading: boolean\n  isSuperuser: boolean\n  isManager: boolean\n  isManagerOrSuperuser: boolean\n  signOut: () => Promise<void>\n  refreshProfile: () => Promise<void>\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  user: null,\n  profile: null,\n  loading: true,\n  isSuperuser: false,\n  isManager: false,\n  isManagerOrSuperuser: false,\n  signOut: async () => {},\n  refreshProfile: async () => {}\n})\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [loading, setLoading] = useState(true)\n  const supabaseRef = useRef(createClient())\n  const supabase = supabaseRef.current\n\n  const fetchProfile = async (userId: string) => {\n    const { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', userId)\n      .single()\n    \n    if (error) {\n      console.error('Error fetching profile:', error)\n      return null\n    }\n    return data as Profile\n  }\n\n  const refreshProfile = async () => {\n    if (user) {\n      const profile = await fetchProfile(user.id)\n      setProfile(profile)\n    }\n  }\n\n  useEffect(() => {\n    let mounted = true\n\n    // Use getSession first (reads from local storage, faster)\n    // Then onAuthStateChange will handle token refresh if needed\n    const initAuth = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession()\n\n        if (!mounted) return\n\n        if (error || !session) {\n          setUser(null)\n          setProfile(null)\n          setLoading(false)\n          return\n        }\n\n        setUser(session.user)\n\n        // Fetch profile in background, don't block loading\n        fetchProfile(session.user.id).then(profile => {\n          if (mounted) setProfile(profile)\n        })\n\n        setLoading(false)\n      } catch (error) {\n        console.error('Auth init error:', error)\n        if (mounted) {\n          setUser(null)\n          setProfile(null)\n          setLoading(false)\n        }\n      }\n    }\n\n    initAuth()\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event: any, session: any) => {\n        if (!mounted) return\n\n        if (session?.user) {\n          setUser(session.user)\n          // Fetch profile in background\n          fetchProfile(session.user.id).then(profile => {\n            if (mounted) setProfile(profile)\n          })\n        } else {\n          setUser(null)\n          setProfile(null)\n        }\n\n        setLoading(false)\n      }\n    )\n\n    return () => {\n      mounted = false\n      subscription.unsubscribe()\n    }\n  }, [])\n\n  const signOut = async () => {\n    await supabase.auth.signOut()\n    setUser(null)\n    setProfile(null)\n    // Force redirect to avoid state issues\n    window.location.href = '/login'\n  }\n\n  const isSuperuser = profile?.role === 'superuser'\n  const isManager = profile?.role === 'manager'\n  const isManagerOrSuperuser = isSuperuser || isManager\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      profile,\n      loading,\n      isSuperuser,\n      isManager,\n      isManagerOrSuperuser,\n      signOut,\n      refreshProfile\n    }}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport const useAuth = () => useContext(AuthContext)\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAkBA,MAAM,4BAAc,IAAA,sNAAa,EAAkB;IACjD,MAAM;IACN,SAAS;IACT,SAAS;IACT,aAAa;IACb,WAAW;IACX,sBAAsB;IACtB,SAAS,WAAa;IACtB,gBAAgB,WAAa;AAC/B;AAEO,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAiB;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,cAAc,IAAA,+MAAM,EAAC,IAAA,gJAAY;IACvC,MAAM,WAAW,YAAY,OAAO;IAEpC,MAAM,eAAe,OAAO;QAC1B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO;QACT;QACA,OAAO;IACT;IAEA,MAAM,iBAAiB;QACrB,IAAI,MAAM;YACR,MAAM,UAAU,MAAM,aAAa,KAAK,EAAE;YAC1C,WAAW;QACb;IACF;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,UAAU;QAEd,0DAA0D;QAC1D,6DAA6D;QAC7D,MAAM,WAAW;YACf,IAAI;gBACF,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;gBAEnE,IAAI,CAAC,SAAS;gBAEd,IAAI,SAAS,CAAC,SAAS;oBACrB,QAAQ;oBACR,WAAW;oBACX,WAAW;oBACX;gBACF;gBAEA,QAAQ,QAAQ,IAAI;gBAEpB,mDAAmD;gBACnD,aAAa,QAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;oBACjC,IAAI,SAAS,WAAW;gBAC1B;gBAEA,WAAW;YACb,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,oBAAoB;gBAClC,IAAI,SAAS;oBACX,QAAQ;oBACR,WAAW;oBACX,WAAW;gBACb;YACF;QACF;QAEA;QAEA,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE,GAAG,SAAS,IAAI,CAAC,iBAAiB,CAChE,OAAO,OAAY;YACjB,IAAI,CAAC,SAAS;YAEd,IAAI,SAAS,MAAM;gBACjB,QAAQ,QAAQ,IAAI;gBACpB,8BAA8B;gBAC9B,aAAa,QAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;oBACjC,IAAI,SAAS,WAAW;gBAC1B;YACF,OAAO;gBACL,QAAQ;gBACR,WAAW;YACb;YAEA,WAAW;QACb;QAGF,OAAO;YACL,UAAU;YACV,aAAa,WAAW;QAC1B;IACF,GAAG,EAAE;IAEL,MAAM,UAAU;QACd,MAAM,SAAS,IAAI,CAAC,OAAO;QAC3B,QAAQ;QACR,WAAW;QACX,uCAAuC;QACvC,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,MAAM,cAAc,SAAS,SAAS;IACtC,MAAM,YAAY,SAAS,SAAS;IACpC,MAAM,uBAAuB,eAAe;IAE5C,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAC3B;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACF;kBACG;;;;;;AAGP;AAEO,MAAM,UAAU,IAAM,IAAA,mNAAU,EAAC"}}]
}
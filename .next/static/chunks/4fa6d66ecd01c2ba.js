(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,59897,e=>{"use strict";var r=e.i(43476),t=e.i(71645),u=e.i(11795);let l=(0,t.createContext)({user:null,profile:null,loading:!0,isSuperuser:!1,signOut:async()=>{},refreshProfile:async()=>{}});function n({children:e}){let[n,s]=(0,t.useState)(null),[i,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),h=(0,t.useRef)((0,u.createClient)()).current,f=async e=>{let{data:r,error:t}=await h.from("profiles").select("*").eq("id",e).single();return t?(console.error("Error fetching profile:",t),null):r},d=async()=>{n&&a(await f(n.id))};(0,t.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:r},error:t}=await h.auth.getSession();if(!e)return;if(t||!r){s(null),a(null),c(!1);return}s(r.user),f(r.user.id).then(r=>{e&&a(r)}),c(!1)}catch(r){console.error("Auth init error:",r),e&&(s(null),a(null),c(!1))}})();let{data:{subscription:r}}=h.auth.onAuthStateChange(async(r,t)=>{e&&(t?.user?(s(t.user),f(t.user.id).then(r=>{e&&a(r)})):(s(null),a(null)),c(!1))});return()=>{e=!1,r.unsubscribe()}},[]);let g=async()=>{await h.auth.signOut(),s(null),a(null),window.location.href="/login"};return(0,r.jsx)(l.Provider,{value:{user:n,profile:i,loading:o,isSuperuser:i?.role==="superuser",signOut:g,refreshProfile:d},children:e})}e.s(["AuthProvider",()=>n,"useAuth",0,()=>(0,t.useContext)(l)])}]);
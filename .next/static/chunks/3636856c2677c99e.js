(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},56909,e=>{"use strict";let s=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>s],56909)},43531,e=>{"use strict";let s=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],43531)},37727,e=>{"use strict";let s=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>s],37727)},31278,e=>{"use strict";let s=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},55436,e=>{"use strict";let s=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>s],55436)},63488,e=>{"use strict";let s=(0,e.i(75254).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);e.s(["Mail",()=>s],63488)},87316,e=>{"use strict";let s=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>s],87316)},88511,e=>{"use strict";let s=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>s],88511)},86536,77705,e=>{"use strict";var s=e.i(75254);let a=(0,s.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>a],86536);let t=(0,s.default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);e.s(["EyeOff",()=>t],77705)},84614,e=>{"use strict";let s=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],84614)},98919,63727,e=>{"use strict";var s=e.i(75254);let a=(0,s.default)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);e.s(["Shield",()=>a],98919);let t=(0,s.default)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);e.s(["Briefcase",()=>t],63727)},66228,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(18566),r=e.i(11795),l=e.i(22016),i=e.i(59897),n=e.i(55436),o=e.i(37727),d=e.i(98919),c=e.i(84614),m=e.i(88511),x=e.i(71689),u=e.i(56909),h=e.i(31278),p=e.i(63488),g=e.i(87316),b=e.i(7486),f=e.i(43531),j=e.i(63727),y=e.i(75254);let N=(0,y.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),v=(0,y.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),w=(0,y.default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var k=e.i(86536),C=e.i(77705),_=e.i(75157);let S={superuser:{label:"Amministratore",description:"Accesso completo al sistema",color:"violet",icon:d.Shield},manager:{label:"Data Manager",description:"Gestisce prodotti, fornitori e cantieri",color:"amber",icon:j.Briefcase},user:{label:"Operatore",description:"Movimenti sui cantieri assegnati",color:"blue",icon:c.User}};function M(){let e=(0,t.useRouter)(),y=(0,t.useSearchParams)(),{isSuperuser:M,profile:z}=(0,i.useAuth)(),$="impostazioni"===y.get("from"),[L,E]=(0,a.useState)([]),[q,A]=(0,a.useState)([]),[U,O]=(0,a.useState)([]),[R,P]=(0,a.useState)(!0),[T,B]=(0,a.useState)(""),[D,F]=(0,a.useState)(!1),[H,V]=(0,a.useState)(!1),[G,X]=(0,a.useState)(null),[I,K]=(0,a.useState)(!1),[J,Q]=(0,a.useState)("info"),[W,Y]=(0,a.useState)([]),[Z,ee]=(0,a.useState)(""),[es,ea]=(0,a.useState)(!1),[et,er]=(0,a.useState)([]),[el,ei]=(0,a.useState)(null),en=(0,r.createClient)(),[eo,ed]=(0,a.useState)({email:"",full_name:"",role:"user"}),[ec,em]=(0,a.useState)({email:"",full_name:"",role:"user",redirect_email:"info@bpcleaning.it"});(0,a.useEffect)(()=>{M?ex():e.push("/impostazioni")},[M]);let ex=async()=>{let[e,s,a]=await Promise.all([en.from("profiles").select("*").order("role").order("full_name"),en.from("worksites").select("*").eq("status","active").order("name"),en.from("user_worksites").select("*, worksite:worksites(*), user:profiles(*)")]);e.data&&E(e.data),s.data&&A(s.data),a.data&&O(a.data),P(!1)},eu=async e=>{if(e.preventDefault(),!eo.full_name.trim()||!G)return;K(!0);let{error:s}=await en.from("profiles").update({full_name:eo.full_name.trim(),role:eo.role}).eq("id",G.id);if(s){alert("Errore durante il salvataggio: "+s.message),K(!1);return}if("superuser"!==eo.role&&(await en.from("user_worksites").delete().eq("user_id",G.id),W.length>0)){let e=W.map(e=>({user_id:G.id,worksite_id:e}));await en.from("user_worksites").insert(e)}F(!1),ex(),K(!1)},eh=async e=>{if(e.preventDefault(),ec.email.trim()&&ec.full_name.trim()){K(!0);try{let e=await fetch("/api/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:ec.email.trim(),full_name:ec.full_name.trim(),role:ec.role,redirect_email:ec.redirect_email.trim()||void 0})}),s=await e.json();if(!e.ok){alert("Errore: "+s.error),K(!1);return}s.generated_password&&er(e=>[...e,{email:ec.email.trim(),full_name:ec.full_name.trim(),success:!0,generated_password:s.generated_password,user_id:s.user.id}]),em({email:"",full_name:"",role:"user",redirect_email:"info@bpcleaning.it"}),ex()}catch(e){alert("Errore nella creazione utente")}K(!1)}},ep=L.filter(e=>{if(!T.trim())return!0;let s=T.toLowerCase();return e.full_name.toLowerCase().includes(s)||e.email.toLowerCase().includes(s)}),eg=q.filter(e=>{if(!Z.trim())return!0;let s=Z.toLowerCase();return e.name.toLowerCase().includes(s)||e.code.toLowerCase().includes(s)||e.city?.toLowerCase().includes(s)}),eb=ep.filter(e=>"superuser"===e.role),ef=ep.filter(e=>"manager"===e.role),ej=ep.filter(e=>"user"===e.role);if(!M)return null;if(R)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})});if(H)return(0,s.jsxs)("div",{className:"min-h-screen pb-24",children:[(0,s.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)("button",{onClick:()=>{V(!1),er([])},className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,s.jsx)(x.ArrowLeft,{className:"w-5 h-5"})}),(0,s.jsx)("span",{className:"text-emerald-100",children:"Nuovo Utente"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center",children:(0,s.jsx)(N,{className:"w-7 h-7"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:"Crea Nuovo Utente"}),(0,s.jsx)("p",{className:"text-emerald-100 text-sm",children:"Aggiungi un dipendente al sistema"})]})]})]})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 space-y-4 pt-4",children:[et.length>0&&(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-2xl border border-emerald-200 p-4",children:[(0,s.jsxs)("h3",{className:"font-semibold text-emerald-800 mb-3 flex items-center gap-2",children:[(0,s.jsx)(w,{className:"w-5 h-5"}),"Utenti Creati (",et.length,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:et.map((e,a)=>(0,s.jsxs)("div",{className:"bg-white rounded-xl p-3 border border-emerald-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.full_name}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:e.email})]}),e.generated_password&&(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg p-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Password:"}),(0,s.jsx)("code",{className:"flex-1 font-mono text-sm bg-white px-2 py-1 rounded border",children:es?e.generated_password:"••••••••••••"}),(0,s.jsx)("button",{onClick:()=>ea(!es),className:"p-1.5 hover:bg-gray-200 rounded-lg transition-colors",children:es?(0,s.jsx)(C.EyeOff,{className:"w-4 h-4"}):(0,s.jsx)(k.Eye,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>{var s,a;return s=e.generated_password,a=e.email,void(navigator.clipboard.writeText(s),ei(a),setTimeout(()=>ei(null),2e3))},className:"p-1.5 hover:bg-gray-200 rounded-lg transition-colors",children:el===e.email?(0,s.jsx)(f.Check,{className:"w-4 h-4 text-emerald-600"}):(0,s.jsx)(v,{className:"w-4 h-4"})})]})]},a))}),(0,s.jsx)("p",{className:"text-xs text-emerald-600 mt-3",children:"⚠️ Salva queste password! Non potrai vederle di nuovo."})]}),(0,s.jsxs)("form",{onSubmit:eh,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,s.jsx)("input",{type:"email",value:ec.email,onChange:e=>em({...ec,email:e.target.value}),placeholder:"es. m.rossi@bpcleaning.it",className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),(0,s.jsx)("input",{type:"text",value:ec.full_name,onChange:e=>em({...ec,full_name:e.target.value}),placeholder:"Es. Mario Rossi",className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email per Reset Password"}),(0,s.jsx)("input",{type:"email",value:ec.redirect_email,onChange:e=>em({...ec,redirect_email:e.target.value}),placeholder:"info@bpcleaning.it",className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"L'email dove verranno inviate le richieste di reset password (per alias)"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Ruolo"}),(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(S).map(([e,a])=>{let t=a.icon;return(0,s.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${ec.role===e?`border-${a.color}-500 bg-${a.color}-50`:"border-gray-100 hover:border-gray-200"}`,children:[(0,s.jsx)("input",{type:"radio",name:"role",value:e,checked:ec.role===e,onChange:e=>em({...ec,role:e.target.value}),className:"sr-only"}),(0,s.jsx)("div",{className:`w-10 h-10 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:(0,s.jsx)(t,{className:`w-5 h-5 text-${a.color}-600`})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:a.label}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:a.description})]}),ec.role===e&&(0,s.jsx)("div",{className:`w-6 h-6 rounded-full bg-${a.color}-500 flex items-center justify-center`,children:(0,s.jsx)(f.Check,{className:"w-4 h-4 text-white"})})]},e)})})]}),(0,s.jsx)("button",{type:"submit",disabled:I||!ec.email.trim()||!ec.full_name.trim(),className:"w-full flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-2xl font-semibold hover:from-emerald-700 hover:to-teal-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}),"Creazione in corso..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N,{className:"w-5 h-5"}),"Crea Utente"]})})]}),(0,s.jsx)("div",{className:"bg-amber-50 rounded-2xl border border-amber-100 p-4",children:(0,s.jsxs)("p",{className:"text-sm text-amber-800",children:[(0,s.jsx)("strong",{children:"Nota sugli alias email:"})," Se l'email è un alias (es. m.rossi@bpcleaning.it → info@bpcleaning.it), specifica l'indirizzo reale nel campo \"Email per Reset Password\". Le richieste di reset password verranno inviate a quell'indirizzo."]})})]})]});if(D&&G){let e=S[eo.role].icon;return(0,s.jsxs)("div",{className:"min-h-screen pb-24",children:[(0,s.jsx)("header",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)("button",{onClick:()=>F(!1),className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,s.jsx)(x.ArrowLeft,{className:"w-5 h-5"})}),(0,s.jsx)("span",{className:"text-blue-100",children:"Modifica Utente"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center",children:(0,s.jsx)(e,{className:"w-7 h-7"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:eo.full_name||"Modifica"}),(0,s.jsx)("p",{className:"text-blue-100 text-sm",children:eo.email})]})]})]})}),(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 mb-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-1 flex",children:[(0,s.jsx)("button",{onClick:()=>Q("info"),className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-colors ${"info"===J?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:"Informazioni"}),"superuser"!==eo.role&&(0,s.jsxs)("button",{onClick:()=>Q("cantieri"),className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-colors flex items-center justify-center gap-2 ${"cantieri"===J?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["Cantieri",W.length>0&&(0,s.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs ${"cantieri"===J?"bg-white/20":"bg-blue-100 text-blue-600"}`,children:W.length})]})]})}),(0,s.jsxs)("form",{onSubmit:eu,className:"max-w-4xl mx-auto px-4 space-y-4",children:["info"===J?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email (non modificabile)"}),(0,s.jsx)("input",{type:"email",value:eo.email,disabled:!0,className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-500 bg-gray-50"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),(0,s.jsx)("input",{type:"text",value:eo.full_name,onChange:e=>ed({...eo,full_name:e.target.value}),placeholder:"Es. Mario Rossi",className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Ruolo"}),(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(S).map(([e,a])=>{let t=a.icon,r=G.id===z?.id&&e!==eo.role;return(0,s.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${eo.role===e?`border-${a.color}-500 bg-${a.color}-50`:"border-gray-100 hover:border-gray-200"} ${r?"opacity-50 cursor-not-allowed":""}`,children:[(0,s.jsx)("input",{type:"radio",name:"role",value:e,checked:eo.role===e,onChange:e=>ed({...eo,role:e.target.value}),disabled:r,className:"sr-only"}),(0,s.jsx)("div",{className:`w-10 h-10 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:(0,s.jsx)(t,{className:`w-5 h-5 text-${a.color}-600`})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:a.label}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:a.description})]}),eo.role===e&&(0,s.jsx)("div",{className:`w-6 h-6 rounded-full bg-${a.color}-500 flex items-center justify-center`,children:(0,s.jsx)(f.Check,{className:"w-4 h-4 text-white"})})]},e)})}),G.id===z?.id&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:"Non puoi modificare il tuo ruolo"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Cerca cantiere...",value:Z,onChange:e=>ee(e.target.value),className:"w-full pl-10 pr-10 py-3 bg-white border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),Z&&(0,s.jsx)("button",{type:"button",onClick:()=>ee(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded-full",children:(0,s.jsx)(o.X,{className:"w-4 h-4 text-gray-400"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[W.length," cantieri selezionati"]}),W.length>0&&(0,s.jsx)("button",{type:"button",onClick:()=>Y([]),className:"text-sm text-red-600 font-medium",children:"Rimuovi tutti"})]}),(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden max-h-96 overflow-y-auto",children:0===eg.length?(0,s.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Nessun cantiere trovato"}):eg.map((e,a)=>{let t=W.includes(e.id);return(0,s.jsxs)("button",{type:"button",onClick:()=>{var s;return s=e.id,void Y(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s])},className:`w-full flex items-center gap-3 p-3 text-left transition-colors ${a!==eg.length-1?"border-b border-gray-100":""} ${t?"bg-blue-50":"hover:bg-gray-50"}`,children:[(0,s.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${t?"bg-blue-500":"bg-gray-100"}`,children:t?(0,s.jsx)(f.Check,{className:"w-5 h-5 text-white"}):(0,s.jsx)(b.Building2,{className:"w-5 h-5 text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 truncate",children:[e.code," • ",e.city]})]})]},e.id)})}),(0,s.jsx)("div",{className:"bg-amber-50 rounded-2xl border border-amber-100 p-4",children:(0,s.jsxs)("p",{className:"text-sm text-amber-800",children:[(0,s.jsx)("strong",{children:"Nota:"})," L'utente potrà accedere solo ai cantieri selezionati.","user"===eo.role&&" Gli operatori potranno registrare movimenti solo su questi cantieri.","manager"===eo.role&&" I manager potranno modificare solo questi cantieri."]})})]}),(0,s.jsx)("button",{type:"submit",disabled:I||!eo.full_name.trim(),className:"w-full flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}),"Salvataggio..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Save,{className:"w-5 h-5"}),"Salva Modifiche"]})})]})]})}let ey=(e,a,t=0)=>{let r,l=S[e.role],i=l.icon,n=(r=e.id,U.filter(e=>e.user_id===r).length);return(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 animate-slide-up",style:{animationDelay:`${(t+a)*.05}s`},children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:`w-12 h-12 bg-${l.color}-100 rounded-full flex items-center justify-center`,children:(0,s.jsx)(i,{className:`w-6 h-6 text-${l.color}-600`})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold text-gray-900",children:[e.full_name,e.id===z?.id&&(0,s.jsx)("span",{className:"ml-2 text-xs text-violet-600",children:"(tu)"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,s.jsx)(p.Mail,{className:"w-3 h-3"}),e.email]})]})]}),(0,s.jsx)("button",{onClick:()=>{X(e),ed({email:e.email,full_name:e.full_name,role:e.role}),Y(U.filter(s=>s.user_id===e.id).map(e=>e.worksite_id)),Q("info"),F(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors",children:(0,s.jsx)(m.Edit,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-3 ml-15",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[(0,s.jsx)(g.Calendar,{className:"w-3 h-3"}),(0,_.formatDate)(e.created_at)]}),"superuser"!==e.role&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[(0,s.jsx)(b.Building2,{className:"w-3 h-3"}),n," ",1===n?"cantiere":"cantieri"]})]})]},e.id)};return(0,s.jsxs)("div",{className:"min-h-screen",children:[(0,s.jsx)("header",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(l.default,{href:$?"/impostazioni":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,s.jsx)(x.ArrowLeft,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:"Gestione Utenti"}),(0,s.jsxs)("p",{className:"text-blue-100 text-sm",children:[L.length," utenti registrati"]})]}),(0,s.jsx)("button",{onClick:()=>V(!0),className:"p-2.5 bg-white/20 hover:bg-white/30 rounded-xl transition-colors",children:(0,s.jsx)(N,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-300"}),(0,s.jsx)("input",{type:"text",placeholder:"Cerca utente...",value:T,onChange:e=>B(e.target.value),className:"w-full pl-10 pr-10 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white/30"}),T&&(0,s.jsx)("button",{onClick:()=>B(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded-full",children:(0,s.jsx)(o.X,{className:"w-4 h-4 text-blue-200"})})]})]})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 space-y-4 pb-24 pt-4",children:[eb.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,s.jsx)(d.Shield,{className:"w-4 h-4"}),"Amministratori (",eb.length,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:eb.map((e,s)=>ey(e,s))})]}),ef.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,s.jsx)(j.Briefcase,{className:"w-4 h-4"}),"Data Manager (",ef.length,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:ef.map((e,s)=>ey(e,s,eb.length))})]}),ej.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,s.jsx)(c.User,{className:"w-4 h-4"}),"Operatori (",ej.length,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:ej.map((e,s)=>ey(e,s,eb.length+ef.length))})]}),0===ep.length&&T&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,s.jsx)(n.Search,{className:"w-8 h-8"})}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun risultato"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 max-w-sm",children:['Nessun utente trovato per "',T,'"']}),(0,s.jsx)("button",{onClick:()=>B(""),className:"mt-4 text-blue-600 font-medium",children:"Cancella ricerca"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded-2xl border border-blue-100 p-4 mt-6",children:[(0,s.jsx)("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"Ruoli disponibili"}),(0,s.jsxs)("div",{className:"space-y-2 text-xs text-blue-600",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Amministratore"}),": accesso completo a tutto il sistema"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Data Manager"}),": gestisce prodotti, fornitori e cantieri (no report costi)"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Operatore"}),": registra movimenti solo sui cantieri assegnati"]})]})]}),(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-2xl border border-emerald-100 p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-emerald-700 font-medium mb-1 flex items-center gap-2",children:[(0,s.jsx)(N,{className:"w-4 h-4"}),"Aggiungere nuovi utenti"]}),(0,s.jsxs)("p",{className:"text-xs text-emerald-600",children:["Usa il pulsante ",(0,s.jsx)("strong",{children:"+"})," in alto a destra per creare nuovi account. Puoi impostare un'email alias che punta a un indirizzo reale per il reset password."]})]})]})]})}function z(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)(h.Loader2,{className:"w-8 h-8 text-blue-600 animate-spin"})}),children:(0,s.jsx)(M,{})})}e.s(["default",()=>z],66228)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73375,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],73375)},51737,e=>{"use strict";let t=(0,e.i(75254).default)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);e.s(["ShieldAlert",()=>t],51737)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},27639,e=>{"use strict";let t={detergente:"consumabile",sgrassatore:"consumabile",disinfettante:"consumabile",lucidante:"consumabile",deodorante:"consumabile",accessorio:"attrezzatura",attrezzatura:"attrezzatura",altro:"attrezzatura"};e.s(["CATEGORIES_BY_TYPE",0,{all:["detergente","sgrassatore","disinfettante","lucidante","deodorante","accessorio","attrezzatura","altro"],consumabile:["detergente","sgrassatore","disinfettante","lucidante","deodorante"],attrezzatura:["accessorio","attrezzatura","altro"]},"CATEGORY_ICONS",0,{detergente:"ðŸ§´",sgrassatore:"ðŸ’ª",disinfettante:"ðŸ§¹",lucidante:"âœ¨",deodorante:"ðŸŒ¸",accessorio:"ðŸ§¤",attrezzatura:"ðŸ› ï¸",altro:"ðŸ“¦"},"CATEGORY_LABELS",0,{detergente:"Detergente",sgrassatore:"Sgrassatore",disinfettante:"Disinfettante",lucidante:"Lucidante",deodorante:"Deodorante",accessorio:"Accessorio",attrezzatura:"Attrezzatura",altro:"Altro"},"STATUS_LABELS",0,{active:"Attivo",paused:"In pausa",completed:"Completato"},"UNIT_LABELS",0,{litri:"Litri",pezzi:"Pezzi",kg:"Kg",ml:"ml",rotoli:"Rotoli",confezioni:"Confezioni"},"filterProductsByType",0,(e,a)=>"all"===a?e:e.filter(e=>t[e.category]===a)])},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},35956,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-up-from-line",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);e.s(["ArrowUpFromLine",()=>t],35956)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},55900,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],55900)},83086,95116,4499,34343,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>a],83086);let r=(0,t.default)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]);e.s(["Wrench",()=>r],95116);let s=(0,t.default)("scan-barcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);e.s(["ScanBarcode",()=>s],4499);var l=e.i(71645);function n(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=()=>{let e="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<768;t(e&&a)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}function i({onScan:e,enabled:t=!0,minLength:a=5,maxDelay:r=50}){let s=(0,l.useRef)(""),n=(0,l.useRef)(0),i=(0,l.useRef)(null),o=(0,l.useCallback)(()=>{s.current="",i.current&&(clearTimeout(i.current),i.current=null)},[]),c=(0,l.useCallback)(()=>{let t=s.current.trim();t.length>=a&&(console.log("[BarcodeScanner] Detected barcode:",t),e(t)),o()},[a,e,o]);return(0,l.useEffect)(()=>{if(!t)return;let e=e=>{let t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)return;let l=Date.now();if(l-n.current>r&&s.current.length>0&&o(),"Enter"===e.key){e.preventDefault(),c();return}1!==e.key.length||e.ctrlKey||e.altKey||e.metaKey||(s.current+=e.key,n.current=l,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current.length>=a?c():o()},100))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),i.current&&clearTimeout(i.current)}},[t,r,a,c,o]),{resetBuffer:o}}e.s(["useBarcodeScanner",()=>i,"useIsMobile",()=>n],34343)},20582,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(11795),s=e.i(59897),l=e.i(75157),n=e.i(27639),i=e.i(35956),o=e.i(68553),c=e.i(55436),d=e.i(99023),u=e.i(7233),m=e.i(43531),x=e.i(37727),h=e.i(64659),g=e.i(55900),f=e.i(73375),p=e.i(31278),b=e.i(51737),y=e.i(88844),j=e.i(83086),w=e.i(95116),v=e.i(4499),N=e.i(22016),k=e.i(18566);e.i(2898);var C=e.i(16081),S=e.i(77878),_=e.i(49146),z=e.i(34343);function T(){let e,{user:T,profile:E,isManager:M,loading:A}=(0,s.useAuth)(),L=(0,k.useRouter)(),B=(0,k.useSearchParams)(),D=B.get("product"),P=B.get("cantiere"),O="movimenti"===B.get("from"),[I,R]=(0,a.useState)([]),[U,q]=(0,a.useState)([]),[F,Y]=(0,a.useState)([]),[G,K]=(0,a.useState)(!0),[V,$]=(0,a.useState)(""),[X,H]=(0,a.useState)("all"),[W,Q]=(0,a.useState)(null),[J,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)(null),[ea,er]=(0,a.useState)(null),[es,el]=(0,a.useState)(1),[en,ei]=(0,a.useState)(new Date().toISOString().split("T")[0]),[eo,ec]=(0,a.useState)(!1),[ed,eu]=(0,a.useState)(!1),[em,ex]=(0,a.useState)(null),[eh,eg]=(0,a.useState)(!1),[ef,ep]=(0,a.useState)(!1),[eb,ey]=(0,a.useState)(null),ej=(0,a.useRef)(null),ew=(0,a.useRef)(null),ev=(0,r.createClient)(),[eN,ek]=(0,a.useState)(null),eC=(0,z.useIsMobile)(),eS=(0,a.useCallback)(e=>{let t=I.find(t=>t.barcode===e);t?(et(t),ek(e),setTimeout(()=>ek(null),2e3)):(ey(`Prodotto non trovato: ${e}`),setTimeout(()=>ey(null),3e3))},[I]);(0,z.useBarcodeScanner)({onScan:eS,enabled:!ee&&!ef&&I.length>0&&!eC,minLength:5}),(0,a.useEffect)(()=>{!A&&M&&L.replace("/")},[M,A,L]),(0,a.useEffect)(()=>{if(M)return;let e=!0;return(async()=>{try{let{products:t,worksites:a,recentProducts:r}=await e_();if(D&&t&&e){let e=t.find(e=>e.id===D);e&&et(e)}if(P&&a&&e){let e=a.find(e=>e.id===P);e&&er(e)}}finally{e&&K(!1)}})(),()=>{e=!1,eL()}},[D,P,T?.id,M]);let e_=async()=>{let[e,t]=await Promise.all([ev.from("products").select("*").eq("is_active",!0).order("name"),ev.from("worksites").select("*").eq("status","active").order("code")]);e.data&&R(e.data),t.data&&Y(t.data);let a=[];if(T?.id&&e.data){let t=new Date;t.setDate(t.getDate()-30);let{data:r}=await ev.from("movements").select("product_id, created_at").eq("operator_id",T.id).eq("type","scarico").gte("created_at",t.toISOString()).order("created_at",{ascending:!1});if(r&&r.length>0){let t=new Set,s=[];for(let e of r)t.has(e.product_id)||(t.add(e.product_id),s.push(e.product_id));let l=new Map(e.data.map(e=>[e.id,e]));a=s.map(e=>l.get(e)).filter(e=>void 0!==e).slice(0,10)}}return q(a),{products:e.data,worksites:t.data,recentProducts:a}},ez=(e=I,J?e=I.filter(e=>e.category===J):"all"!==X&&(e=(0,n.filterProductsByType)(I,X)),e.filter(e=>e.name.toLowerCase().includes(V.toLowerCase())||e.barcode?.toLowerCase().includes(V.toLowerCase()))),eT=e=>{"all"===e?(H("all"),Q(null),Z(null)):W===e?(Q(null),Z(null),H(e)):(H(e),Q(e),Z(null))},eE=async()=>{if(ee&&ea&&T){ec(!0);try{let{data:e,error:t}=await ev.from("products").select("current_stock").eq("id",ee.id).single();if(t)throw t;if(e.current_stock<es){alert(`Stock insufficiente! Disponibili solo ${e.current_stock} unit\xe0.`),et({...ee,current_stock:e.current_stock}),el(Math.min(es,e.current_stock)),ec(!1);return}let{error:a}=await ev.from("movements").insert({type:"scarico",product_id:ee.id,worksite_id:ea.id,quantity:es,unit_cost_at_time:ee.unit_cost,operator_id:T.id,movement_date:en});if(a)throw a;ex({product:ee.name,quantity:es,worksite:`${ea.code} ${ea.name}`,total:es*ee.unit_cost}),eu(!0),et(null),el(1),ei(new Date().toISOString().split("T")[0]),$("")}catch(e){console.error("Error:",e),alert("Errore durante lo scarico")}finally{ec(!1)}}},eM=(0,a.useCallback)(e=>{let t=I.find(t=>t.barcode===e);t?(et(t),eL()):(ey(`Prodotto non trovato: ${e}`),setTimeout(()=>ey(null),3e3))},[I]),eA=async()=>{ep(!0),ey(null);try{let e=new Map;e.set(_.DecodeHintType.POSSIBLE_FORMATS,[S.BarcodeFormat.EAN_13,S.BarcodeFormat.EAN_8,S.BarcodeFormat.CODE_128,S.BarcodeFormat.CODE_39,S.BarcodeFormat.UPC_A,S.BarcodeFormat.UPC_E,S.BarcodeFormat.QR_CODE]);let t=new C.BrowserMultiFormatReader(e);ew.current=t;let a=await t.listVideoInputDevices(),r=a[0]?.deviceId,s=a.find(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear")||e.label.toLowerCase().includes("environment"));if(s&&(r=s.deviceId),!r)throw Error("Nessuna fotocamera trovata");await t.decodeFromVideoDevice(r,ej.current,(e,t)=>{if(e){let t=e.getText();console.log("Barcode detected:",t),eM(t)}})}catch(e){console.error("Scanner error:",e),ey("Impossibile accedere alla fotocamera"),ep(!1)}},eL=(0,a.useCallback)(()=>{ew.current&&(ew.current.reset(),ew.current=null),ep(!1),ey(null)},[]);return A?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(p.Loader2,{className:"w-8 h-8 text-orange-600 animate-spin"})}):M?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:(0,t.jsx)(b.ShieldAlert,{className:"w-8 h-8 text-red-600"})}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Accesso Negato"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Non hai i permessi per accedere ai movimenti."}),(0,t.jsx)("button",{onClick:()=>L.push("/"),className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-medium",children:"Torna alla Home"})]}):G?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}):ed&&em?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm",children:"Operazione completata"})]})]})}),(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(m.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Scarico Registrato!"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-4",children:[em.quantity,"x ",em.product,(0,t.jsx)("br",{}),"â†’ ",em.worksite]}),(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:(0,l.formatCurrency)(em.total)}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:()=>{eu(!1),ex(null)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Scarico"}),(0,t.jsx)("button",{onClick:()=>L.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Vai a Movimenti"})]})]})})]}):ee?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm truncate",children:ee.name})]})]})}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto Selezionato"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center text-2xl",children:"ðŸ§´"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:ee.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Barcode: ",ee.barcode||"N/A"]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[ee.quantity_per_package," ",ee.unit," â€¢ ",(0,l.formatCurrency)(ee.unit_cost),"/pz"]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Data Movimento"}),(0,t.jsx)("input",{type:"date",value:en,onChange:e=>ei(e.target.value),max:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-center text-lg font-semibold"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"QuantitÃ  da Scaricare"}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{onClick:()=>el(Math.max(1,es-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,t.jsx)(d.Minus,{className:"w-6 h-6"})}),(0,t.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:es}),(0,t.jsx)("button",{onClick:()=>el(Math.min(ee.current_stock,es+1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,t.jsx)(u.Plus,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Disponibili: ",(0,t.jsx)("span",{className:"font-semibold",children:(0,l.formatNumber)(ee.current_stock,0)})," â€¢ Costo: ",(0,t.jsx)("span",{className:"font-semibold text-orange-600",children:(0,l.formatCurrency)(es*ee.unit_cost)})]})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Cantiere destinazione *"}),(0,t.jsxs)("button",{onClick:()=>eg(!0),className:"w-full flex items-center justify-between p-3 border border-gray-200 rounded-xl",children:[ea?(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:[ea.code," - ",ea.name]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[ea.address,", ",ea.city]})]}):(0,t.jsx)("span",{className:"text-gray-400",children:"Seleziona cantiere..."}),(0,t.jsx)(h.ChevronDown,{className:"w-5 h-5 text-gray-400"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{onClick:()=>{et(null),el(1),ei(new Date().toISOString().split("T")[0])},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,t.jsx)("button",{onClick:eE,disabled:!ea||eo,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:eo?(0,t.jsx)(p.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]}),eh&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",children:(0,t.jsxs)("div",{className:"bg-white w-full rounded-t-3xl p-4 max-h-[70vh] overflow-auto animate-slide-up",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:"Seleziona Cantiere"}),(0,t.jsx)("button",{onClick:()=>eg(!1),children:(0,t.jsx)(x.X,{className:"w-6 h-6 text-gray-400"})})]}),(0,t.jsx)("div",{className:"space-y-2",children:F.map(e=>(0,t.jsxs)("button",{onClick:()=>{er(e),eg(!1)},className:(0,l.cn)("w-full p-4 rounded-xl text-left transition-all",ea?.id===e.id?"bg-orange-100 border-2 border-orange-500":"bg-gray-50 border-2 border-transparent"),children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.code," - ",e.name]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.address,", ",e.city]})]},e.id))})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,t.jsx)(N.default,{href:O?"/movimenti":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,t.jsx)(f.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[!eC&&(0,t.jsxs)("div",{className:(0,l.cn)("flex items-center gap-3 p-4 rounded-2xl border-2 transition-all",eN?"bg-emerald-50 border-emerald-500":"bg-orange-50 border-orange-200"),children:[(0,t.jsx)("div",{className:(0,l.cn)("w-10 h-10 rounded-xl flex items-center justify-center",eN?"bg-emerald-500 text-white":"bg-orange-500 text-white"),children:(0,t.jsx)(v.ScanBarcode,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:eN?"Barcode rilevato!":"Pistola barcode pronta"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:eN||"Scansiona un prodotto con la pistola USB"})]}),eN&&(0,t.jsx)(m.Check,{className:"w-6 h-6 text-emerald-500"})]}),eC&&(ef?(0,t.jsxs)("div",{className:"relative h-48 bg-gray-900 rounded-2xl overflow-hidden",children:[(0,t.jsx)("video",{ref:ej,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-32 h-32 border-2 border-cyan-400 rounded-xl relative",children:(0,t.jsx)("div",{className:"scanner-line"})})}),eb&&(0,t.jsx)("div",{className:"absolute bottom-3 left-3 right-3 bg-red-500 text-white text-sm px-3 py-2 rounded-lg text-center",children:eb}),(0,t.jsx)("button",{onClick:eL,className:"absolute top-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:(0,t.jsx)(x.X,{className:"w-4 h-4 text-white"})}),(0,t.jsx)("div",{className:"absolute top-3 left-3 bg-black/50 text-white text-xs px-2 py-1 rounded",children:"Inquadra il barcode"})]}):(0,t.jsxs)("button",{onClick:eA,className:"w-full h-32 bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400 hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(o.Camera,{className:"w-8 h-8"}),(0,t.jsx)("span",{className:"text-sm",children:"Tocca per scansionare barcode"})]})),(0,t.jsxs)("div",{children:[eC&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:V,onChange:e=>$(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>eT("all"),className:(0,l.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","all"!==X||J?"bg-white text-gray-600 border border-gray-200":"bg-orange-100 text-orange-700 border border-orange-200"),children:[(0,t.jsx)(y.Package,{className:"w-4 h-4"}),"Tutti"]}),(0,t.jsxs)("button",{onClick:()=>eT("consumabile"),className:(0,l.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","consumabile"===X?"bg-emerald-100 text-emerald-700 border border-emerald-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,t.jsx)(j.Sparkles,{className:"w-4 h-4"}),"Pulizia","consumabile"===W?(0,t.jsx)(g.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,t.jsx)(h.ChevronDown,{className:"w-3 h-3 ml-1"})]}),(0,t.jsxs)("button",{onClick:()=>eT("attrezzatura"),className:(0,l.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","attrezzatura"===X?"bg-violet-100 text-violet-700 border border-violet-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,t.jsx)(w.Wrench,{className:"w-4 h-4"}),"Attrezz.","attrezzatura"===W?(0,t.jsx)(g.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,t.jsx)(h.ChevronDown,{className:"w-3 h-3 ml-1"})]})]}),W&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 animate-slide-up",children:n.CATEGORIES_BY_TYPE[W].map(e=>(0,t.jsxs)("button",{onClick:()=>{J===e?Z(null):Z(e)},className:(0,l.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",J===e?"consumabile"===W?"bg-emerald-500 text-white":"bg-violet-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,t.jsx)("span",{children:n.CATEGORY_ICONS[e]}),n.CATEGORY_LABELS[e]]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:V||"all"!==X?"Risultati":U.length>0?"Usati di recente":"Tutti i prodotti"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(V||"all"!==X?ez.slice(0,15):U.length>0?U:ez.slice(0,10)).map(e=>(0,t.jsxs)("button",{onClick:()=>et(e),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-orange-100",children:n.CATEGORY_ICONS[e.category]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.quantity_per_package,e.unit," â€¢ ",(0,l.formatCurrency)(e.unit_cost)]})]}),(0,t.jsx)("span",{className:(0,l.cn)("font-bold",e.current_stock<=e.min_stock?"text-red-500":"text-emerald-500"),children:(0,l.formatNumber)(e.current_stock,0)})]},e.id)),!V&&"all"===X&&U.length>0&&(0,t.jsx)("button",{onClick:()=>$(" "),className:"w-full p-3 text-center text-orange-600 font-medium text-sm hover:bg-orange-50 rounded-xl transition-colors",children:"Mostra tutti i prodotti â†’"})]})]})]})]})}function E(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}),children:(0,t.jsx)(T,{})})}e.s(["default",()=>E])}]);
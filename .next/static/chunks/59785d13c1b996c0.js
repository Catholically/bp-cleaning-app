(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},28480,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-down-to-line",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);e.s(["ArrowDownToLine",()=>t],28480)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},12589,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(11795),s=e.i(59897),l=e.i(75157),i=e.i(28480),o=e.i(55436),c=e.i(99023),n=e.i(7233),d=e.i(43531),m=e.i(31278),x=e.i(68553),u=e.i(37727),h=e.i(18566);e.i(2898);var f=e.i(16081),p=e.i(77878),b=e.i(49146);function g(){let{user:e}=(0,s.useAuth)(),g=(0,h.useRouter)(),j=(0,h.useSearchParams)().get("product"),[y,w]=(0,r.useState)([]),[N,v]=(0,r.useState)([]),[C,k]=(0,r.useState)(!0),[_,S]=(0,r.useState)(""),[M,T]=(0,r.useState)(null),[L,D]=(0,r.useState)(1),[A,B]=(0,r.useState)(!1),[P,E]=(0,r.useState)(!1),[F,O]=(0,r.useState)(null),[R,I]=(0,r.useState)(!1),[q,z]=(0,r.useState)(null),U=(0,r.useRef)(null),V=(0,r.useRef)(null),H=(0,a.createClient)();(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let{products:t}=await K();if(j&&t&&e){let e=t.find(e=>e.id===j);e&&T(e)}}finally{e&&k(!1)}})(),()=>{e=!1,G()}},[j,e?.id]);let K=async()=>{let{data:t}=await H.from("products").select("*").eq("is_active",!0).order("name");t&&w(t);let r=[];if(e?.id&&t){let a=new Date;a.setDate(a.getDate()-30);let{data:s}=await H.from("movements").select("product_id, created_at").eq("operator_id",e.id).eq("type","carico").gte("created_at",a.toISOString()).order("created_at",{ascending:!1});if(s&&s.length>0){let e=new Set,a=[];for(let t of s)e.has(t.product_id)||(e.add(t.product_id),a.push(t.product_id));let l=new Map(t.map(e=>[e.id,e]));r=a.map(e=>l.get(e)).filter(e=>void 0!==e).slice(0,10)}}return v(r),{products:t,recentProducts:r}},Q=(0,r.useCallback)(e=>{let t=y.find(t=>t.barcode===e);t?(T(t),G()):(z(`Prodotto non trovato: ${e}`),setTimeout(()=>z(null),3e3))},[y]),X=async()=>{I(!0),z(null);try{let e=new Map;e.set(b.DecodeHintType.POSSIBLE_FORMATS,[p.BarcodeFormat.EAN_13,p.BarcodeFormat.EAN_8,p.BarcodeFormat.CODE_128,p.BarcodeFormat.CODE_39,p.BarcodeFormat.UPC_A,p.BarcodeFormat.UPC_E,p.BarcodeFormat.QR_CODE]);let t=new f.BrowserMultiFormatReader(e);V.current=t;let r=await t.listVideoInputDevices(),a=r[0]?.deviceId,s=r.find(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear")||e.label.toLowerCase().includes("environment"));if(s&&(a=s.deviceId),!a)throw Error("Nessuna fotocamera trovata");await t.decodeFromVideoDevice(a,U.current,e=>{if(e){let t=e.getText();console.log("Barcode detected:",t),Q(t)}})}catch(e){console.error("Scanner error:",e),z("Impossibile accedere alla fotocamera"),I(!1)}},G=(0,r.useCallback)(()=>{V.current&&(V.current.reset(),V.current=null),I(!1),z(null)},[]),$=y.filter(e=>e.name.toLowerCase().includes(_.toLowerCase())||e.barcode?.toLowerCase().includes(_.toLowerCase())),J=async()=>{if(M&&e){B(!0);try{let{error:t}=await H.from("movements").insert({type:"carico",product_id:M.id,quantity:L,unit_cost_at_time:M.unit_cost,operator_id:e.id});if(t)throw t;O({product:M.name,quantity:L,total:L*M.unit_cost,newStock:M.current_stock+L}),E(!0),T(null),D(1),S("")}catch(e){console.error("Error:",e),alert("Errore durante il carico")}finally{B(!1)}}};return C?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}):P&&F?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowDownToLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,t.jsx)("p",{className:"text-emerald-100 text-sm",children:"Operazione completata"})]})]})}),(0,t.jsx)("div",{className:"px-4 -mt-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(d.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Carico Registrato!"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-4",children:["+",F.quantity,"x ",F.product]}),(0,t.jsxs)("p",{className:"text-lg text-gray-700",children:["Nuova giacenza: ",(0,t.jsx)("span",{className:"font-bold text-emerald-600",children:F.newStock})]}),(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-600 mt-2",children:(0,l.formatCurrency)(F.total)}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:()=>{E(!1),O(null),K()},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Carico"}),(0,t.jsx)("button",{onClick:()=>g.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Torna ai Movimenti"})]})]})})]}):M?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowDownToLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,t.jsx)("p",{className:"text-emerald-100 text-sm truncate",children:M.name})]})]})}),(0,t.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center text-2xl",children:"ðŸ§´"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:M.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,l.formatCurrency)(M.unit_cost),"/pz â€¢ Giacenza attuale: ",(0,l.formatNumber)(M.current_stock,0)]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"QuantitÃ  da Caricare"}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{onClick:()=>D(Math.max(1,L-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,t.jsx)(c.Minus,{className:"w-6 h-6"})}),(0,t.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:L}),(0,t.jsx)("button",{onClick:()=>D(L+1),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,t.jsx)(n.Plus,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Valore: ",(0,t.jsx)("span",{className:"font-semibold text-emerald-600",children:(0,l.formatCurrency)(L*M.unit_cost)})]})})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{onClick:()=>{T(null),D(1)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,t.jsx)("button",{onClick:J,disabled:A,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:A?(0,t.jsx)(m.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]})]}):(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowDownToLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,t.jsx)("p",{className:"text-emerald-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,t.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[R?(0,t.jsxs)("div",{className:"relative h-48 sm:h-56 md:h-64 max-w-md mx-auto bg-gray-900 rounded-2xl overflow-hidden",children:[(0,t.jsx)("video",{ref:U,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-32 h-32 sm:w-40 sm:h-40 border-2 border-cyan-400 rounded-xl relative",children:(0,t.jsx)("div",{className:"scanner-line"})})}),q&&(0,t.jsx)("div",{className:"absolute bottom-3 left-3 right-3 bg-red-500 text-white text-sm px-3 py-2 rounded-lg text-center",children:q}),(0,t.jsx)("button",{onClick:G,className:"absolute top-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:(0,t.jsx)(u.X,{className:"w-4 h-4 text-white"})}),(0,t.jsx)("div",{className:"absolute top-3 left-3 bg-black/50 text-white text-xs px-2 py-1 rounded",children:"Inquadra il barcode"})]}):(0,t.jsxs)("button",{onClick:X,className:"w-full h-32 sm:h-40 max-w-md mx-auto bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400 hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(x.Camera,{className:"w-8 h-8"}),(0,t.jsx)("span",{className:"text-sm",children:"Tocca per scansionare barcode"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:_,onChange:e=>S(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:_?"Risultati ricerca":N.length>0?"Caricati di recente":"Tutti i prodotti"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(_?$.slice(0,15):N.length>0?N:$.slice(0,10)).map(e=>(0,t.jsxs)("button",{onClick:()=>T(e),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-emerald-100",children:"ðŸ§´"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,l.formatCurrency)(e.unit_cost),"/pz"]})]}),(0,t.jsx)("span",{className:"font-bold text-gray-900",children:(0,l.formatNumber)(e.current_stock,0)})]},e.id)),!_&&N.length>0&&(0,t.jsx)("button",{onClick:()=>S(" "),className:"w-full p-3 text-center text-emerald-600 font-medium text-sm hover:bg-emerald-50 rounded-xl transition-colors",children:"Mostra tutti i prodotti â†’"})]})]})]})]})}function j(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}),children:(0,t.jsx)(g,{})})}e.s(["default",()=>j])}]);
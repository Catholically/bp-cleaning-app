(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73375,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],73375)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},43972,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),i=e.i(11795),r=e.i(59897),l=e.i(75157),c=e.i(7486),n=e.i(7233),d=e.i(46897),o=e.i(55436),m=e.i(37727),x=e.i(73375),h=e.i(31278),u=e.i(22016);function p(){let{isSuperuser:e}=(0,r.useAuth)();(0,a.useRouter)();let h="impostazioni"===(0,a.useSearchParams)().get("from"),[p,f]=(0,s.useState)([]),[g,j]=(0,s.useState)(!0),[b,y]=(0,s.useState)(""),N=(0,i.createClient)();(0,s.useEffect)(()=>{v()},[]);let v=async()=>{let{data:e}=await N.from("worksites").select("*").order("status").order("code");if(e){let t=new Date;t.setDate(1),t.setHours(0,0,0,0);let{data:s}=await N.from("movements").select("worksite_id, total_cost").eq("type","scarico").gte("created_at",t.toISOString()),a=(s||[]).reduce((e,t)=>(t.worksite_id&&(e[t.worksite_id]=(e[t.worksite_id]||0)+(t.total_cost||0)),e),{});f(e.map(e=>({...e,monthly_cost:a[e.id]||0})))}j(!1)},w=p.filter(e=>{if(!b.trim())return!0;let t=b.toLowerCase();return e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)||e.address?.toLowerCase().includes(t)||e.city?.toLowerCase().includes(t)}),k=w.filter(e=>"active"===e.status),C=w.filter(e=>"active"!==e.status);return g?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-violet-600 border-t-transparent rounded-full animate-spin"})}):(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-violet-500 via-purple-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)(u.default,{href:h?"/impostazioni":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,t.jsx)(x.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsx)(c.Building2,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Cantieri"}),(0,t.jsxs)("p",{className:"text-purple-100 text-sm",children:[p.length," cantieri totali"]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-300"}),(0,t.jsx)("input",{type:"text",placeholder:"Cerca cantiere...",value:b,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-10 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/30"}),b&&(0,t.jsx)("button",{onClick:()=>y(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded-full",children:(0,t.jsx)(m.X,{className:"w-4 h-4 text-purple-200"})})]})]})}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4 pb-24",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Attivi (",k.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:k.map((e,s)=>(0,t.jsxs)(u.default,{href:`/cantieri/${e.id}`,className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 block animate-slide-up",style:{animationDelay:`${.05*s}s`},children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"badge-info text-xs",children:e.code}),(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mt-1",children:e.name})]}),(0,t.jsx)("p",{className:"text-xl font-bold text-violet-600",children:(0,l.formatCurrency)(e.monthly_cost||0)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,t.jsx)(d.MapPin,{className:"w-4 h-4"}),e.address,", ",e.city]}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"questo mese"})]},e.id))})]}),C.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Non attivi (",C.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:C.map(e=>(0,t.jsxs)(u.default,{href:`/cantieri/${e.id}`,className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 opacity-60",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("span",{className:"badge-neutral text-xs",children:e.code}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.name})]}),(0,t.jsx)("span",{className:(0,l.cn)("badge","paused"===e.status?"badge-warning":"badge-neutral"),children:"paused"===e.status?"In pausa":"Completato"})]},e.id))})]}),0===w.length&&b&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,t.jsx)(o.Search,{className:"w-8 h-8"})}),(0,t.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun risultato"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 max-w-sm",children:['Nessun cantiere trovato per "',b,'"']}),(0,t.jsx)("button",{onClick:()=>y(""),className:"mt-4 text-violet-600 font-medium",children:"Cancella ricerca"})]}),0===p.length&&!b&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,t.jsx)(c.Building2,{className:"w-8 h-8"})}),(0,t.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun cantiere"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 max-w-sm",children:"Aggiungi il primo cantiere per iniziare"})]})]}),e&&(0,t.jsx)(u.default,{href:"/cantieri/nuovo",className:"fixed bottom-24 right-4 w-14 h-14 rounded-full bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-xl flex items-center justify-center z-50 hover:from-blue-700 hover:to-blue-800 active:scale-95 transition-all duration-200 bg-gradient-to-r from-violet-600 to-purple-600",children:(0,t.jsx)(n.Plus,{className:"w-6 h-6"})})]})}function f(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(h.Loader2,{className:"w-8 h-8 text-violet-600 animate-spin"})}),children:(0,t.jsx)(p,{})})}e.s(["default",()=>f])}]);
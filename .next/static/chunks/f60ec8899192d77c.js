(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},35956,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-up-from-line",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);e.s(["ArrowUpFromLine",()=>t],35956)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},99023,e=>{"use strict";let t=(0,e.i(75254).default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);e.s(["Minus",()=>t],99023)},20582,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(11795),a=e.i(59897),l=e.i(75157),i=e.i(35956);let n=(0,e.i(75254).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var c=e.i(55436),o=e.i(99023),d=e.i(7233),x=e.i(43531),m=e.i(37727),u=e.i(64659),h=e.i(31278),f=e.i(18566);function g(){let{user:e,profile:g}=(0,a.useAuth)(),p=(0,f.useRouter)(),b=(0,f.useSearchParams)(),j=b.get("product"),y=b.get("cantiere"),[N,w]=(0,s.useState)([]),[v,k]=(0,s.useState)([]),[C,S]=(0,s.useState)(!0),[_,M]=(0,s.useState)(""),[A,L]=(0,s.useState)(null),[z,O]=(0,s.useState)(null),[P,q]=(0,s.useState)(1),[T,U]=(0,s.useState)(!1),[R,D]=(0,s.useState)(!1),[E,F]=(0,s.useState)(null),[B,X]=(0,s.useState)(!1),[$,H]=(0,s.useState)(!1),I=(0,s.useRef)(null),K=(0,r.createClient)();(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{let{products:t,worksites:s}=await Q();if(j&&t&&e){let e=t.find(e=>e.id===j);e&&L(e)}if(y&&s&&e){let e=s.find(e=>e.id===y);e&&O(e)}}finally{e&&S(!1)}})(),()=>{e=!1,I.current?.srcObject&&I.current.srcObject.getTracks().forEach(e=>e.stop())}},[j,y]);let Q=async()=>{let[e,t]=await Promise.all([K.from("products").select("*").eq("is_active",!0).order("name"),K.from("worksites").select("*").eq("status","active").order("code")]);return e.data&&w(e.data),t.data&&k(t.data),{products:e.data,worksites:t.data}},V=N.filter(e=>e.name.toLowerCase().includes(_.toLowerCase())||e.barcode?.toLowerCase().includes(_.toLowerCase())),G=async()=>{if(A&&z&&e){U(!0);try{let{data:t,error:s}=await K.from("products").select("current_stock").eq("id",A.id).single();if(s)throw s;if(t.current_stock<P){alert(`Stock insufficiente! Disponibili solo ${t.current_stock} unit\xe0.`),L({...A,current_stock:t.current_stock}),q(Math.min(P,t.current_stock)),U(!1);return}let{error:r}=await K.from("movements").insert({type:"scarico",product_id:A.id,worksite_id:z.id,quantity:P,unit_cost_at_time:A.unit_cost,operator_id:e.id});if(r)throw r;F({product:A.name,quantity:P,worksite:`${z.code} ${z.name}`,total:P*A.unit_cost}),D(!0),L(null),q(1),M("")}catch(e){console.error("Error:",e),alert("Errore durante lo scarico")}finally{U(!1)}}},J=async()=>{H(!0);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});I.current&&(I.current.srcObject=e)}catch(e){console.error("Camera error:",e),alert("Impossibile accedere alla fotocamera"),H(!1)}};return C?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}):R&&E?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm",children:"Operazione completata"})]})]})}),(0,t.jsx)("div",{className:"px-4 -mt-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(x.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Scarico Registrato!"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-4",children:[E.quantity,"x ",E.product,(0,t.jsx)("br",{}),"â†’ ",E.worksite]}),(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:(0,l.formatCurrency)(E.total)}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:()=>{D(!1),F(null)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Scarico"}),(0,t.jsx)("button",{onClick:()=>p.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Torna ai Movimenti"})]})]})})]}):A?(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm truncate",children:A.name})]})]})}),(0,t.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto Selezionato"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center text-2xl",children:"ðŸ§´"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:A.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Barcode: ",A.barcode||"N/A"]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[A.quantity_per_package," ",A.unit," â€¢ ",(0,l.formatCurrency)(A.unit_cost),"/pz"]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"QuantitÃ  da Scaricare"}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{onClick:()=>q(Math.max(1,P-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,t.jsx)(o.Minus,{className:"w-6 h-6"})}),(0,t.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:P}),(0,t.jsx)("button",{onClick:()=>q(Math.min(A.current_stock,P+1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,t.jsx)(d.Plus,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Disponibili: ",(0,t.jsx)("span",{className:"font-semibold",children:(0,l.formatNumber)(A.current_stock,0)})," â€¢ Costo: ",(0,t.jsx)("span",{className:"font-semibold text-orange-600",children:(0,l.formatCurrency)(P*A.unit_cost)})]})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Cantiere destinazione *"}),(0,t.jsxs)("button",{onClick:()=>X(!0),className:"w-full flex items-center justify-between p-3 border border-gray-200 rounded-xl",children:[z?(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:[z.code," - ",z.name]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[z.address,", ",z.city]})]}):(0,t.jsx)("span",{className:"text-gray-400",children:"Seleziona cantiere..."}),(0,t.jsx)(u.ChevronDown,{className:"w-5 h-5 text-gray-400"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{onClick:()=>{L(null),q(1)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,t.jsx)("button",{onClick:G,disabled:!z||T,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:T?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]}),B&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",children:(0,t.jsxs)("div",{className:"bg-white w-full rounded-t-3xl p-4 max-h-[70vh] overflow-auto animate-slide-up",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:"Seleziona Cantiere"}),(0,t.jsx)("button",{onClick:()=>X(!1),children:(0,t.jsx)(m.X,{className:"w-6 h-6 text-gray-400"})})]}),(0,t.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,t.jsxs)("button",{onClick:()=>{O(e),X(!1)},className:(0,l.cn)("w-full p-4 rounded-xl text-left transition-all",z?.id===e.id?"bg-orange-100 border-2 border-orange-500":"bg-gray-50 border-2 border-transparent"),children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.code," - ",e.name]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.address,", ",e.city]})]},e.id))})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.ArrowUpFromLine,{className:"w-6 h-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,t.jsx)("p",{className:"text-orange-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,t.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[$?(0,t.jsxs)("div",{className:"relative h-48 sm:h-56 md:h-64 max-w-md mx-auto bg-gray-900 rounded-2xl overflow-hidden",children:[(0,t.jsx)("video",{ref:I,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-32 h-32 sm:w-40 sm:h-40 border-2 border-cyan-400 rounded-xl relative",children:(0,t.jsx)("div",{className:"scanner-line"})})}),(0,t.jsx)("button",{onClick:()=>{I.current?.srcObject&&I.current.srcObject.getTracks().forEach(e=>e.stop()),H(!1)},className:"absolute top-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.X,{className:"w-4 h-4 text-white"})})]}):(0,t.jsxs)("button",{onClick:J,className:"w-full h-32 sm:h-40 max-w-md mx-auto bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400",children:[(0,t.jsx)(n,{className:"w-8 h-8"}),(0,t.jsx)("span",{className:"text-sm",children:"Tocca per attivare fotocamera"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:_,onChange:e=>M(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:_?"Risultati ricerca":"Prodotti recenti"}),(0,t.jsx)("div",{className:"space-y-2",children:V.slice(0,10).map(e=>(0,t.jsxs)("button",{onClick:()=>L(e),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-orange-100",children:"ðŸ§´"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.quantity_per_package,e.unit," â€¢ ",(0,l.formatCurrency)(e.unit_cost)]})]}),(0,t.jsx)("span",{className:(0,l.cn)("font-bold",e.current_stock<=e.min_stock?"text-red-500":"text-emerald-500"),children:(0,l.formatNumber)(e.current_stock,0)})]},e.id))})]})]})]})}function p(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}),children:(0,t.jsx)(g,{})})}e.s(["default",()=>p],20582)}]);
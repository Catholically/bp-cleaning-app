module.exports=[24987,a=>{"use strict";let b=(0,a.i(70106).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],24987)},87532,a=>{"use strict";let b=(0,a.i(70106).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);a.s(["Search",()=>b],87532)},15618,a=>{"use strict";let b=(0,a.i(70106).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],15618)},33508,a=>{"use strict";let b=(0,a.i(70106).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},49266,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95445),e=a.i(64696),f=a.i(68114),g=a.i(67900),h=a.i(15618),i=a.i(24987),j=a.i(87532),k=a.i(33508),l=a.i(38246);function m(){let{isSuperuser:a}=(0,e.useAuth)(),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(""),s=(0,d.createClient)();(0,c.useEffect)(()=>{t()},[]);let t=async()=>{let{data:a}=await s.from("worksites").select("*").order("status").order("code");if(a){let b=new Date;b.setDate(1),b.setHours(0,0,0,0);let{data:c}=await s.from("movements").select("worksite_id, total_cost").eq("type","scarico").gte("created_at",b.toISOString()),d=(c||[]).reduce((a,b)=>(b.worksite_id&&(a[b.worksite_id]=(a[b.worksite_id]||0)+(b.total_cost||0)),a),{});n(a.map(a=>({...a,monthly_cost:d[a.id]||0})))}p(!1)},u=m.filter(a=>{if(!q.trim())return!0;let b=q.toLowerCase();return a.name.toLowerCase().includes(b)||a.code.toLowerCase().includes(b)||a.address?.toLowerCase().includes(b)||a.city?.toLowerCase().includes(b)}),v=u.filter(a=>"active"===a.status),w=u.filter(a=>"active"!==a.status);return o?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-violet-600 border-t-transparent rounded-full animate-spin"})}):(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsxs)("header",{className:"bg-gradient-to-r from-violet-500 via-purple-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)(g.Building2,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Cantieri"}),(0,b.jsxs)("p",{className:"text-purple-100 text-sm",children:[m.length," cantieri totali"]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-300"}),(0,b.jsx)("input",{type:"text",placeholder:"Cerca cantiere...",value:q,onChange:a=>r(a.target.value),className:"w-full pl-10 pr-10 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/30"}),q&&(0,b.jsx)("button",{onClick:()=>r(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded-full",children:(0,b.jsx)(k.X,{className:"w-4 h-4 text-purple-200"})})]})]}),(0,b.jsxs)("div",{className:"px-4 -mt-4 space-y-4 pb-24",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Attivi (",v.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:v.map((a,c)=>(0,b.jsxs)(l.default,{href:`/cantieri/${a.id}`,className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 block animate-slide-up",style:{animationDelay:`${.05*c}s`},children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"badge-info text-xs",children:a.code}),(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mt-1",children:a.name})]}),(0,b.jsx)("p",{className:"text-xl font-bold text-violet-600",children:(0,f.formatCurrency)(a.monthly_cost||0)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,b.jsx)(i.MapPin,{className:"w-4 h-4"}),a.address,", ",a.city]}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"questo mese"})]},a.id))})]}),w.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Non attivi (",w.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:w.map(a=>(0,b.jsxs)(l.default,{href:`/cantieri/${a.id}`,className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 opacity-60",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("span",{className:"badge-neutral text-xs",children:a.code}),(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.name})]}),(0,b.jsx)("span",{className:(0,f.cn)("badge","paused"===a.status?"badge-warning":"badge-neutral"),children:"paused"===a.status?"In pausa":"Completato"})]},a.id))})]}),0===u.length&&q&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,b.jsx)(j.Search,{className:"w-8 h-8"})}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun risultato"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 max-w-sm",children:['Nessun cantiere trovato per "',q,'"']}),(0,b.jsx)("button",{onClick:()=>r(""),className:"mt-4 text-violet-600 font-medium",children:"Cancella ricerca"})]}),0===m.length&&!q&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,b.jsx)(g.Building2,{className:"w-8 h-8"})}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun cantiere"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 max-w-sm",children:"Aggiungi il primo cantiere per iniziare"})]})]}),a&&(0,b.jsx)(l.default,{href:"/cantieri/nuovo",className:"fixed bottom-24 right-4 w-14 h-14 rounded-full bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-xl flex items-center justify-center z-50 hover:from-blue-700 hover:to-blue-800 active:scale-95 transition-all duration-200 bg-gradient-to-r from-violet-600 to-purple-600",children:(0,b.jsx)(h.Plus,{className:"w-6 h-6"})})]})}a.s(["default",()=>m])}];

//# sourceMappingURL=_21b0797b._.js.map
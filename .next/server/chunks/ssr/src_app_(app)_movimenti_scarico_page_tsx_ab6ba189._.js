module.exports=[11335,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95445),e=a.i(64696),f=a.i(68114),g=a.i(55488);let h=(0,a.i(70106).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var i=a.i(87532),j=a.i(23025),k=a.i(15618),l=a.i(33441),m=a.i(33508),n=a.i(5784),o=a.i(96221),p=a.i(50944);function q(){let{user:a,profile:q}=(0,e.useAuth)(),r=(0,p.useRouter)(),s=(0,p.useSearchParams)().get("product"),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1),R=(0,c.useRef)(null),S=(0,d.createClient)();(0,c.useEffect)(()=>{let a=!0;return(async()=>{try{let b=await T();if(s&&b&&a){let a=b.find(a=>a.id===s);a&&C(a)}}finally{a&&y(!1)}})(),()=>{a=!1,R.current?.srcObject&&R.current.srcObject.getTracks().forEach(a=>a.stop())}},[s]);let T=async()=>{let[a,b]=await Promise.all([S.from("products").select("*").eq("is_active",!0).order("name"),S.from("worksites").select("*").eq("status","active").order("code")]);return a.data&&u(a.data),b.data&&w(b.data),a.data},U=t.filter(a=>a.name.toLowerCase().includes(z.toLowerCase())||a.barcode?.toLowerCase().includes(z.toLowerCase())),V=async()=>{if(B&&D&&a){I(!0);try{let{data:b,error:c}=await S.from("products").select("current_stock").eq("id",B.id).single();if(c)throw c;if(b.current_stock<F){alert(`Stock insufficiente! Disponibili solo ${b.current_stock} unit\xe0.`),C({...B,current_stock:b.current_stock}),G(Math.min(F,b.current_stock)),I(!1);return}let{error:d}=await S.from("movements").insert({type:"scarico",product_id:B.id,worksite_id:D.id,quantity:F,unit_cost_at_time:B.unit_cost,operator_id:a.id});if(d)throw d;M({product:B.name,quantity:F,worksite:`${D.code} ${D.name}`,total:F*B.unit_cost}),K(!0),C(null),G(1),A("")}catch(a){console.error("Error:",a),alert("Errore durante lo scarico")}finally{I(!1)}}},W=async()=>{Q(!0);try{let a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});R.current&&(R.current.srcObject=a)}catch(a){console.error("Camera error:",a),alert("Impossibile accedere alla fotocamera"),Q(!1)}};return x?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}):J&&L?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(g.ArrowUpFromLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,b.jsx)("p",{className:"text-orange-100 text-sm",children:"Operazione completata"})]})]})}),(0,b.jsx)("div",{className:"px-4 -mt-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(l.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Scarico Registrato!"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:[L.quantity,"x ",L.product,(0,b.jsx)("br",{}),"â†’ ",L.worksite]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:(0,f.formatCurrency)(L.total)}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,b.jsx)("button",{onClick:()=>{K(!1),M(null)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Scarico"}),(0,b.jsx)("button",{onClick:()=>r.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Torna ai Movimenti"})]})]})})]}):B?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(g.ArrowUpFromLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,b.jsx)("p",{className:"text-orange-100 text-sm truncate",children:B.name})]})]})}),(0,b.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto Selezionato"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center text-2xl",children:"ðŸ§´"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:B.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Barcode: ",B.barcode||"N/A"]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[B.quantity_per_package," ",B.unit," â€¢ ",(0,f.formatCurrency)(B.unit_cost),"/pz"]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"QuantitÃ  da Scaricare"}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,b.jsx)("button",{onClick:()=>G(Math.max(1,F-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,b.jsx)(j.Minus,{className:"w-6 h-6"})}),(0,b.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:F}),(0,b.jsx)("button",{onClick:()=>G(Math.min(B.current_stock,F+1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,b.jsx)(k.Plus,{className:"w-6 h-6"})})]}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Disponibili: ",(0,b.jsx)("span",{className:"font-semibold",children:(0,f.formatNumber)(B.current_stock,0)})," â€¢ Costo: ",(0,b.jsx)("span",{className:"font-semibold text-orange-600",children:(0,f.formatCurrency)(F*B.unit_cost)})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Cantiere destinazione *"}),(0,b.jsxs)("button",{onClick:()=>O(!0),className:"w-full flex items-center justify-between p-3 border border-gray-200 rounded-xl",children:[D?(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900",children:[D.code," - ",D.name]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[D.address,", ",D.city]})]}):(0,b.jsx)("span",{className:"text-gray-400",children:"Seleziona cantiere..."}),(0,b.jsx)(n.ChevronDown,{className:"w-5 h-5 text-gray-400"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{onClick:()=>{C(null),G(1)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,b.jsx)("button",{onClick:V,disabled:!D||H,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 focus:ring-orange-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:H?(0,b.jsx)(o.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]}),N&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",children:(0,b.jsxs)("div",{className:"bg-white w-full rounded-t-3xl p-4 max-h-[70vh] overflow-auto animate-slide-up",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-bold",children:"Seleziona Cantiere"}),(0,b.jsx)("button",{onClick:()=>O(!1),children:(0,b.jsx)(m.X,{className:"w-6 h-6 text-gray-400"})})]}),(0,b.jsx)("div",{className:"space-y-2",children:v.map(a=>(0,b.jsxs)("button",{onClick:()=>{E(a),O(!1)},className:(0,f.cn)("w-full p-4 rounded-xl text-left transition-all",D?.id===a.id?"bg-orange-100 border-2 border-orange-500":"bg-gray-50 border-2 border-transparent"),children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900",children:[a.code," - ",a.name]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[a.address,", ",a.city]})]},a.id))})]})})]}):(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(g.ArrowUpFromLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Scarico Merce"}),(0,b.jsx)("p",{className:"text-orange-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,b.jsxs)("div",{className:"px-4 -mt-4 space-y-4",children:[P?(0,b.jsxs)("div",{className:"relative aspect-square bg-gray-900 rounded-2xl overflow-hidden",children:[(0,b.jsx)("video",{ref:R,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-48 h-48 border-2 border-cyan-400 rounded-xl relative",children:(0,b.jsx)("div",{className:"scanner-line"})})}),(0,b.jsx)("button",{onClick:()=>{R.current?.srcObject&&R.current.srcObject.getTracks().forEach(a=>a.stop()),Q(!1)},className:"absolute top-4 right-4 w-10 h-10 bg-black/50 rounded-full flex items-center justify-center",children:(0,b.jsx)(m.X,{className:"w-5 h-5 text-white"})})]}):(0,b.jsxs)("button",{onClick:W,className:"w-full aspect-video bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400",children:[(0,b.jsx)(h,{className:"w-10 h-10"}),(0,b.jsx)("span",{children:"Tocca per attivare fotocamera"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:z,onChange:a=>A(a.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:z?"Risultati ricerca":"Prodotti recenti"}),(0,b.jsx)("div",{className:"space-y-2",children:U.slice(0,10).map(a=>(0,b.jsxs)("button",{onClick:()=>C(a),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-orange-100",children:"ðŸ§´"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[a.quantity_per_package,a.unit," â€¢ ",(0,f.formatCurrency)(a.unit_cost)]})]}),(0,b.jsx)("span",{className:(0,f.cn)("font-bold",a.current_stock<=a.min_stock?"text-red-500":"text-emerald-500"),children:(0,f.formatNumber)(a.current_stock,0)})]},a.id))})]})]})]})}function r(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-orange-600 border-t-transparent rounded-full animate-spin"})}),children:(0,b.jsx)(q,{})})}a.s(["default",()=>r],11335)}];

//# sourceMappingURL=src_app_%28app%29_movimenti_scarico_page_tsx_ab6ba189._.js.map
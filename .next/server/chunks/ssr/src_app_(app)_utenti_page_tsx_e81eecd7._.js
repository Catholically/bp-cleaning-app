module.exports=[87465,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95445),f=a.i(38246),g=a.i(64696),h=a.i(87532),i=a.i(33508),j=a.i(3314),k=a.i(46842),l=a.i(24569),m=a.i(210),n=a.i(14548),o=a.i(96221),p=a.i(92258),q=a.i(41675),r=a.i(67900),s=a.i(33441),t=a.i(41961),u=a.i(68114);let v={superuser:{label:"Amministratore",description:"Accesso completo al sistema",color:"violet",icon:j.Shield},manager:{label:"Data Manager",description:"Gestisce prodotti, fornitori e cantieri",color:"amber",icon:t.Briefcase},user:{label:"Operatore",description:"Movimenti sui cantieri assegnati",color:"blue",icon:k.User}};function w(){let a=(0,d.useRouter)(),w=(0,d.useSearchParams)(),{isSuperuser:x,profile:y}=(0,g.useAuth)(),z="impostazioni"===w.get("from"),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)("info"),[S,T]=(0,c.useState)([]),[U,V]=(0,c.useState)(""),W=(0,e.createClient)(),[X,Y]=(0,c.useState)({email:"",full_name:"",role:"user"});(0,c.useEffect)(()=>{x?Z():a.push("/impostazioni")},[x]);let Z=async()=>{let[a,b,c]=await Promise.all([W.from("profiles").select("*").order("role").order("full_name"),W.from("worksites").select("*").eq("status","active").order("name"),W.from("user_worksites").select("*, worksite:worksites(*), user:profiles(*)")]);a.data&&B(a.data),b.data&&D(b.data),c.data&&F(c.data),H(!1)},$=async a=>{if(a.preventDefault(),!X.full_name.trim()||!M)return;P(!0);let{error:b}=await W.from("profiles").update({full_name:X.full_name.trim(),role:X.role}).eq("id",M.id);if(b){alert("Errore durante il salvataggio: "+b.message),P(!1);return}if("superuser"!==X.role&&(await W.from("user_worksites").delete().eq("user_id",M.id),S.length>0)){let a=S.map(a=>({user_id:M.id,worksite_id:a}));await W.from("user_worksites").insert(a)}L(!1),Z(),P(!1)},_=A.filter(a=>{if(!I.trim())return!0;let b=I.toLowerCase();return a.full_name.toLowerCase().includes(b)||a.email.toLowerCase().includes(b)}),aa=C.filter(a=>{if(!U.trim())return!0;let b=U.toLowerCase();return a.name.toLowerCase().includes(b)||a.code.toLowerCase().includes(b)||a.city?.toLowerCase().includes(b)}),ab=_.filter(a=>"superuser"===a.role),ac=_.filter(a=>"manager"===a.role),ad=_.filter(a=>"user"===a.role);if(!x)return null;if(G)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})});if(K&&M){let a=v[X.role].icon;return(0,b.jsxs)("div",{className:"min-h-screen pb-24",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("button",{onClick:()=>L(!1),className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,b.jsx)(m.ArrowLeft,{className:"w-5 h-5"})}),(0,b.jsx)("span",{className:"text-blue-100",children:"Modifica Utente"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center",children:(0,b.jsx)(a,{className:"w-7 h-7"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:X.full_name||"Modifica"}),(0,b.jsx)("p",{className:"text-blue-100 text-sm",children:X.email})]})]})]})}),(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 mb-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-1 flex",children:[(0,b.jsx)("button",{onClick:()=>R("info"),className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-colors ${"info"===Q?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:"Informazioni"}),"superuser"!==X.role&&(0,b.jsxs)("button",{onClick:()=>R("cantieri"),className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-colors flex items-center justify-center gap-2 ${"cantieri"===Q?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["Cantieri",S.length>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs ${"cantieri"===Q?"bg-white/20":"bg-blue-100 text-blue-600"}`,children:S.length})]})]})}),(0,b.jsxs)("form",{onSubmit:$,className:"max-w-4xl mx-auto px-4 space-y-4",children:["info"===Q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email (non modificabile)"}),(0,b.jsx)("input",{type:"email",value:X.email,disabled:!0,className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-500 bg-gray-50"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),(0,b.jsx)("input",{type:"text",value:X.full_name,onChange:a=>Y({...X,full_name:a.target.value}),placeholder:"Es. Mario Rossi",className:"w-full px-4 py-3 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Ruolo"}),(0,b.jsx)("div",{className:"space-y-2",children:Object.entries(v).map(([a,c])=>{let d=c.icon,e=M.id===y?.id&&a!==X.role;return(0,b.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${X.role===a?`border-${c.color}-500 bg-${c.color}-50`:"border-gray-100 hover:border-gray-200"} ${e?"opacity-50 cursor-not-allowed":""}`,children:[(0,b.jsx)("input",{type:"radio",name:"role",value:a,checked:X.role===a,onChange:a=>Y({...X,role:a.target.value}),disabled:e,className:"sr-only"}),(0,b.jsx)("div",{className:`w-10 h-10 rounded-xl bg-${c.color}-100 flex items-center justify-center`,children:(0,b.jsx)(d,{className:`w-5 h-5 text-${c.color}-600`})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:c.label}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:c.description})]}),X.role===a&&(0,b.jsx)("div",{className:`w-6 h-6 rounded-full bg-${c.color}-500 flex items-center justify-center`,children:(0,b.jsx)(s.Check,{className:"w-4 h-4 text-white"})})]},a)})}),M.id===y?.id&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:"Non puoi modificare il tuo ruolo"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Cerca cantiere...",value:U,onChange:a=>V(a.target.value),className:"w-full pl-10 pr-10 py-3 bg-white border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),U&&(0,b.jsx)("button",{type:"button",onClick:()=>V(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded-full",children:(0,b.jsx)(i.X,{className:"w-4 h-4 text-gray-400"})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[S.length," cantieri selezionati"]}),S.length>0&&(0,b.jsx)("button",{type:"button",onClick:()=>T([]),className:"text-sm text-red-600 font-medium",children:"Rimuovi tutti"})]}),(0,b.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden max-h-96 overflow-y-auto",children:0===aa.length?(0,b.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Nessun cantiere trovato"}):aa.map((a,c)=>{let d=S.includes(a.id);return(0,b.jsxs)("button",{type:"button",onClick:()=>{var b;return b=a.id,void T(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:`w-full flex items-center gap-3 p-3 text-left transition-colors ${c!==aa.length-1?"border-b border-gray-100":""} ${d?"bg-blue-50":"hover:bg-gray-50"}`,children:[(0,b.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${d?"bg-blue-500":"bg-gray-100"}`,children:d?(0,b.jsx)(s.Check,{className:"w-5 h-5 text-white"}):(0,b.jsx)(r.Building2,{className:"w-5 h-5 text-gray-400"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 truncate",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 truncate",children:[a.code," • ",a.city]})]})]},a.id)})}),(0,b.jsx)("div",{className:"bg-amber-50 rounded-2xl border border-amber-100 p-4",children:(0,b.jsxs)("p",{className:"text-sm text-amber-800",children:[(0,b.jsx)("strong",{children:"Nota:"})," L'utente potrà accedere solo ai cantieri selezionati.","user"===X.role&&" Gli operatori potranno registrare movimenti solo su questi cantieri.","manager"===X.role&&" I manager potranno modificare solo questi cantieri."]})})]}),(0,b.jsx)("button",{type:"submit",disabled:O||!X.full_name.trim(),className:"w-full flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:O?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Loader2,{className:"w-5 h-5 animate-spin"}),"Salvataggio..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Save,{className:"w-5 h-5"}),"Salva Modifiche"]})})]})]})}let ae=(a,c,d=0)=>{let e,f=v[a.role],g=f.icon,h=(e=a.id,E.filter(a=>a.user_id===e).length);return(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 animate-slide-up",style:{animationDelay:`${(d+c)*.05}s`},children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-12 h-12 bg-${f.color}-100 rounded-full flex items-center justify-center`,children:(0,b.jsx)(g,{className:`w-6 h-6 text-${f.color}-600`})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-900",children:[a.full_name,a.id===y?.id&&(0,b.jsx)("span",{className:"ml-2 text-xs text-violet-600",children:"(tu)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,b.jsx)(p.Mail,{className:"w-3 h-3"}),a.email]})]})]}),(0,b.jsx)("button",{onClick:()=>{N(a),Y({email:a.email,full_name:a.full_name,role:a.role}),T(E.filter(b=>b.user_id===a.id).map(a=>a.worksite_id)),R("info"),L(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors",children:(0,b.jsx)(l.Edit,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-3 ml-15",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[(0,b.jsx)(q.Calendar,{className:"w-3 h-3"}),(0,u.formatDate)(a.created_at)]}),"superuser"!==a.role&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[(0,b.jsx)(r.Building2,{className:"w-3 h-3"}),h," ",1===h?"cantiere":"cantieri"]})]})]},a.id)};return(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)(f.default,{href:z?"/impostazioni":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,b.jsx)(m.ArrowLeft,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Gestione Utenti"}),(0,b.jsxs)("p",{className:"text-blue-100 text-sm",children:[A.length," utenti registrati"]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-300"}),(0,b.jsx)("input",{type:"text",placeholder:"Cerca utente...",value:I,onChange:a=>J(a.target.value),className:"w-full pl-10 pr-10 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white/30"}),I&&(0,b.jsx)("button",{onClick:()=>J(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded-full",children:(0,b.jsx)(i.X,{className:"w-4 h-4 text-blue-200"})})]})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 space-y-4 pb-24 pt-4",children:[ab.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,b.jsx)(j.Shield,{className:"w-4 h-4"}),"Amministratori (",ab.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:ab.map((a,b)=>ae(a,b))})]}),ac.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,b.jsx)(t.Briefcase,{className:"w-4 h-4"}),"Data Manager (",ac.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:ac.map((a,b)=>ae(a,b,ab.length))})]}),ad.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,b.jsx)(k.User,{className:"w-4 h-4"}),"Operatori (",ad.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:ad.map((a,b)=>ae(a,b,ab.length+ac.length))})]}),0===_.length&&I&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,b.jsx)(h.Search,{className:"w-8 h-8"})}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun risultato"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 max-w-sm",children:['Nessun utente trovato per "',I,'"']}),(0,b.jsx)("button",{onClick:()=>J(""),className:"mt-4 text-blue-600 font-medium",children:"Cancella ricerca"})]}),(0,b.jsxs)("div",{className:"bg-blue-50 rounded-2xl border border-blue-100 p-4 mt-6",children:[(0,b.jsx)("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"Ruoli disponibili"}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-blue-600",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Amministratore"}),": accesso completo a tutto il sistema"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Data Manager"}),": gestisce prodotti, fornitori e cantieri (no report costi)"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Operatore"}),": registra movimenti solo sui cantieri assegnati"]})]})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-2xl border border-gray-100 p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"Come aggiungere nuovi utenti"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Per aggiungere un nuovo utente, chiedigli di registrarsi tramite la pagina di login. Dopo la registrazione, potrai modificare il suo ruolo e assegnargli i cantieri da qui."})]})]})]})}function x(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)(o.Loader2,{className:"w-8 h-8 text-blue-600 animate-spin"})}),children:(0,b.jsx)(w,{})})}a.s(["default",()=>x])}];

//# sourceMappingURL=src_app_%28app%29_utenti_page_tsx_e81eecd7._.js.map
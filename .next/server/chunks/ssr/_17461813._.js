module.exports=[33508,a=>{"use strict";let b=(0,a.i(70106).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},96221,a=>{"use strict";let b=(0,a.i(70106).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},87532,a=>{"use strict";let b=(0,a.i(70106).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);a.s(["Search",()=>b],87532)},15618,a=>{"use strict";let b=(0,a.i(70106).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],15618)},13749,a=>{"use strict";let b=(0,a.i(70106).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],13749)},5784,a=>{"use strict";let b=(0,a.i(70106).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);a.s(["ChevronDown",()=>b],5784)},60246,a=>{"use strict";let b=(0,a.i(70106).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);a.s(["Users",()=>b],60246)},24987,a=>{"use strict";let b=(0,a.i(70106).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],24987)},49266,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95445),f=a.i(64696),g=a.i(68114),h=a.i(67900),i=a.i(15618),j=a.i(24987),k=a.i(87532),l=a.i(33508),m=a.i(13749),n=a.i(96221),o=a.i(60246),p=a.i(5784),q=a.i(38246);function r(){let{isSuperuser:a}=(0,f.useAuth)();(0,d.useRouter)();let n="impostazioni"===(0,d.useSearchParams)().get("from"),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(new Set),B=(0,e.createClient)();(0,c.useEffect)(()=>{C()},[]);let C=async()=>{let{data:a}=await B.from("worksites").select("*").order("status").order("code");if(a){let b=new Date;b.setDate(1),b.setHours(0,0,0,0);let{data:c}=await B.from("movements").select("worksite_id, total_cost").eq("type","scarico").gte("created_at",b.toISOString()),d=(c||[]).reduce((a,b)=>(b.worksite_id&&(a[b.worksite_id]=(a[b.worksite_id]||0)+(b.total_cost||0)),a),{}),{data:e}=await B.from("worker_assignments").select(`
          worksite_id,
          workers (
            id,
            full_name
          )
        `),f=(e||[]).reduce((a,b)=>(b.worksite_id&&b.workers&&(a[b.worksite_id]||(a[b.worksite_id]=[]),a[b.worksite_id].push(b.workers)),a),{});s(a.map(a=>({...a,monthly_cost:d[a.id]||0,workers:f[a.id]||[]})))}u(!1)},D=[...new Set(r.map(a=>a.client_group).filter(Boolean))].sort(),E=r.filter(a=>{let b=!v.trim()||a.name.toLowerCase().includes(v.toLowerCase())||a.code.toLowerCase().includes(v.toLowerCase())||a.address?.toLowerCase().includes(v.toLowerCase())||a.city?.toLowerCase().includes(v.toLowerCase()),c=!x||a.client_group===x;return b&&c}),F=E.filter(a=>"active"===a.status),G=E.filter(a=>"active"!==a.status);return t?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-violet-600 border-t-transparent rounded-full animate-spin"})}):(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-violet-500 via-purple-600 to-indigo-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)(q.default,{href:n?"/impostazioni":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,b.jsx)(m.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)(h.Building2,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Cantieri"}),(0,b.jsxs)("p",{className:"text-purple-100 text-sm",children:[r.length," cantieri totali"]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-300"}),(0,b.jsx)("input",{type:"text",placeholder:"Cerca cantiere...",value:v,onChange:a=>w(a.target.value),className:"w-full pl-10 pr-10 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/30"}),v&&(0,b.jsx)("button",{onClick:()=>w(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded-full",children:(0,b.jsx)(l.X,{className:"w-4 h-4 text-purple-200"})})]}),D.length>0&&(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:x,onChange:a=>y(a.target.value),className:"w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-white/30",children:[(0,b.jsx)("option",{value:"",children:"Tutti i gruppi"}),D.map(a=>(0,b.jsx)("option",{value:a,className:"text-gray-900",children:a},a))]})})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4 pb-24",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Attivi (",F.length,")"]}),(0,b.jsx)("div",{className:"space-y-3",children:F.map((a,c)=>{let d=z.has(a.id),e=a.workers&&a.workers.length>0;return(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 animate-slide-up",style:{animationDelay:`${.05*c}s`},children:[(0,b.jsxs)(q.default,{href:`/cantieri/${a.id}`,className:"block",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"badge-info text-xs",children:a.code}),(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mt-1",children:a.name})]}),(0,b.jsx)("p",{className:"text-xl font-bold text-violet-600",children:(0,g.formatCurrency)(a.monthly_cost||0)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,b.jsx)(j.MapPin,{className:"w-4 h-4"}),a.address,", ",a.city]}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"questo mese"})]}),e&&(0,b.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,b.jsxs)("button",{onClick:b=>{var c;b.preventDefault(),c=a.id,A(a=>{let b=new Set(a);return b.has(c)?b.delete(c):b.add(c),b})},className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 hover:text-violet-600 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Users,{className:"w-4 h-4"}),(0,b.jsxs)("span",{children:[a.workers.length," ",1===a.workers.length?"lavoratore":"lavoratori"]})]}),(0,b.jsx)(p.ChevronDown,{className:(0,g.cn)("w-4 h-4 transition-transform",d&&"rotate-180")})]}),d&&(0,b.jsx)("div",{className:"mt-2 space-y-1 animate-fade-in",children:a.workers.map(a=>(0,b.jsxs)("div",{className:"text-sm text-gray-600 pl-6 py-1",children:["â€¢ ",a.full_name]},a.id))})]})]},a.id)})})]}),G.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3",children:["Non attivi (",G.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:G.map(a=>(0,b.jsxs)(q.default,{href:`/cantieri/${a.id}`,className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 opacity-60",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("span",{className:"badge-neutral text-xs",children:a.code}),(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.name})]}),(0,b.jsx)("span",{className:(0,g.cn)("badge","paused"===a.status?"badge-warning":"badge-neutral"),children:"paused"===a.status?"In pausa":"Completato"})]},a.id))})]}),0===E.length&&v&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,b.jsx)(k.Search,{className:"w-8 h-8"})}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun risultato"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 max-w-sm",children:['Nessun cantiere trovato per "',v,'"']}),(0,b.jsx)("button",{onClick:()=>w(""),className:"mt-4 text-violet-600 font-medium",children:"Cancella ricerca"})]}),0===r.length&&!v&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mb-4 text-gray-400",children:(0,b.jsx)(h.Building2,{className:"w-8 h-8"})}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nessun cantiere"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 max-w-sm",children:"Aggiungi il primo cantiere per iniziare"})]})]}),a&&(0,b.jsx)(q.default,{href:"/cantieri/nuovo",className:"fixed bottom-24 right-4 w-14 h-14 rounded-full bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-xl flex items-center justify-center z-50 hover:from-blue-700 hover:to-blue-800 active:scale-95 transition-all duration-200 bg-gradient-to-r from-violet-600 to-purple-600",children:(0,b.jsx)(i.Plus,{className:"w-6 h-6"})})]})}function s(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)(n.Loader2,{className:"w-8 h-8 text-violet-600 animate-spin"})}),children:(0,b.jsx)(r,{})})}a.s(["default",()=>s])}];

//# sourceMappingURL=_17461813._.js.map
module.exports=[1286,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95445),e=a.i(64696),f=a.i(68114),g=a.i(39726),h=a.i(7484),i=a.i(87532),j=a.i(23025),k=a.i(15618),l=a.i(33441),m=a.i(96221),n=a.i(13513),o=a.i(33508),p=a.i(66384),q=a.i(83497),r=a.i(8406),s=a.i(79808),t=a.i(5784),u=a.i(67552),v=a.i(13749),w=a.i(38246),x=a.i(50944);a.i(6051);var y=a.i(22909),z=a.i(49623),A=a.i(91345);function B(){let a,{user:B,isManager:C,loading:D}=(0,e.useAuth)(),E=(0,x.useRouter)(),F=(0,x.useSearchParams)(),G=F.get("product"),H="movimenti"===F.get("from"),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)("all"),[ae,af]=(0,c.useState)(null),[ag,ah]=(0,c.useState)(null),ai=(0,c.useRef)(null),aj=(0,c.useRef)(null),ak=(0,d.createClient)();(0,c.useEffect)(()=>{!D&&C&&E.replace("/")},[C,D,E]),(0,c.useEffect)(()=>{if(C)return;let a=!0;return(async()=>{try{let{products:b}=await al();if(G&&b&&a){let a=b.find(a=>a.id===G);a&&R(a)}}finally{a&&N(!1)}})(),()=>{a=!1,ao()}},[G,B?.id,C]);let al=async()=>{let{data:a}=await ak.from("products").select("*").eq("is_active",!0).order("name");a&&J(a);let b=[];if(B?.id&&a){let c=new Date;c.setDate(c.getDate()-30);let{data:d}=await ak.from("movements").select("product_id, created_at").eq("operator_id",B.id).eq("type","carico").gte("created_at",c.toISOString()).order("created_at",{ascending:!1});if(d&&d.length>0){let c=new Set,e=[];for(let a of d)c.has(a.product_id)||(c.add(a.product_id),e.push(a.product_id));let f=new Map(a.map(a=>[a.id,a]));b=e.map(a=>f.get(a)).filter(a=>void 0!==a).slice(0,10)}}return L(b),{products:a,recentProducts:b}},am=(0,c.useCallback)(a=>{let b=I.find(b=>b.barcode===a);b?(R(b),ao()):(ab(`Prodotto non trovato: ${a}`),setTimeout(()=>ab(null),3e3))},[I]),an=async()=>{_(!0),ab(null);try{let a=new Map;a.set(A.DecodeHintType.POSSIBLE_FORMATS,[z.BarcodeFormat.EAN_13,z.BarcodeFormat.EAN_8,z.BarcodeFormat.CODE_128,z.BarcodeFormat.CODE_39,z.BarcodeFormat.UPC_A,z.BarcodeFormat.UPC_E,z.BarcodeFormat.QR_CODE]);let b=new y.BrowserMultiFormatReader(a);aj.current=b;let c=await b.listVideoInputDevices(),d=c[0]?.deviceId,e=c.find(a=>a.label.toLowerCase().includes("back")||a.label.toLowerCase().includes("rear")||a.label.toLowerCase().includes("environment"));if(e&&(d=e.deviceId),!d)throw Error("Nessuna fotocamera trovata");await b.decodeFromVideoDevice(d,ai.current,a=>{if(a){let b=a.getText();console.log("Barcode detected:",b),am(b)}})}catch(a){console.error("Scanner error:",a),ab("Impossibile accedere alla fotocamera"),_(!1)}},ao=(0,c.useCallback)(()=>{aj.current&&(aj.current.reset(),aj.current=null),_(!1),ab(null)},[]),ap=(a=I,ag?a=I.filter(a=>a.category===ag):"all"!==ac&&(a=(0,g.filterProductsByType)(I,ac)),a.filter(a=>a.name.toLowerCase().includes(O.toLowerCase())||a.barcode?.toLowerCase().includes(O.toLowerCase()))),aq=a=>{"all"===a?(ad("all"),af(null),ah(null)):ae===a?(af(null),ah(null),ad(a)):(ad(a),af(a),ah(null))},ar=async()=>{if(Q&&B){V(!0);try{let{error:a}=await ak.from("movements").insert({type:"carico",product_id:Q.id,quantity:S,unit_cost_at_time:Q.unit_cost,operator_id:B.id});if(a)throw a;Z({product:Q.name,quantity:S,total:S*Q.unit_cost,newStock:Q.current_stock+S}),X(!0),R(null),T(1),P("")}catch(a){console.error("Error:",a),alert("Errore durante il carico")}finally{V(!1)}}};return D?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)(m.Loader2,{className:"w-8 h-8 text-emerald-600 animate-spin"})}):C?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:(0,b.jsx)(p.ShieldAlert,{className:"w-8 h-8 text-red-600"})}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Accesso Negato"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Non hai i permessi per accedere ai movimenti."}),(0,b.jsx)("button",{onClick:()=>E.push("/"),className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-medium",children:"Torna alla Home"})]}):M?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}):W&&Y?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm",children:"Operazione completata"})]})]})}),(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(l.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Carico Registrato!"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:["+",Y.quantity,"x ",Y.product]}),(0,b.jsxs)("p",{className:"text-lg text-gray-700",children:["Nuova giacenza: ",(0,b.jsx)("span",{className:"font-bold text-emerald-600",children:Y.newStock})]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-emerald-600 mt-2",children:(0,f.formatCurrency)(Y.total)}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,b.jsx)("button",{onClick:()=>{X(!1),Z(null),al()},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Carico"}),(0,b.jsx)("button",{onClick:()=>E.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Vai a Movimenti"})]})]})})]}):Q?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm truncate",children:Q.name})]})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center text-2xl",children:g.CATEGORY_ICONS[Q.category]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:Q.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,f.formatCurrency)(Q.unit_cost),"/pz • Giacenza attuale: ",(0,f.formatNumber)(Q.current_stock,0)]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"Quantità da Caricare"}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,b.jsx)("button",{onClick:()=>T(Math.max(1,S-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,b.jsx)(j.Minus,{className:"w-6 h-6"})}),(0,b.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:S}),(0,b.jsx)("button",{onClick:()=>T(S+1),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,b.jsx)(k.Plus,{className:"w-6 h-6"})})]}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Valore: ",(0,b.jsx)("span",{className:"font-semibold text-emerald-600",children:(0,f.formatCurrency)(S*Q.unit_cost)})]})})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{onClick:()=>{R(null),T(1)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,b.jsx)("button",{onClick:ar,disabled:U,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:U?(0,b.jsx)(m.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]})]}):(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(w.default,{href:H?"/movimenti":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,b.jsx)(v.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[$?(0,b.jsxs)("div",{className:"relative h-48 sm:h-56 md:h-64 max-w-md mx-auto bg-gray-900 rounded-2xl overflow-hidden",children:[(0,b.jsx)("video",{ref:ai,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-32 h-32 sm:w-40 sm:h-40 border-2 border-cyan-400 rounded-xl relative",children:(0,b.jsx)("div",{className:"scanner-line"})})}),aa&&(0,b.jsx)("div",{className:"absolute bottom-3 left-3 right-3 bg-red-500 text-white text-sm px-3 py-2 rounded-lg text-center",children:aa}),(0,b.jsx)("button",{onClick:ao,className:"absolute top-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:(0,b.jsx)(o.X,{className:"w-4 h-4 text-white"})}),(0,b.jsx)("div",{className:"absolute top-3 left-3 bg-black/50 text-white text-xs px-2 py-1 rounded",children:"Inquadra il barcode"})]}):(0,b.jsxs)("button",{onClick:an,className:"w-full h-32 sm:h-40 max-w-md mx-auto bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400 hover:bg-gray-700 transition-colors",children:[(0,b.jsx)(n.Camera,{className:"w-8 h-8"}),(0,b.jsx)("span",{className:"text-sm",children:"Tocca per scansionare barcode"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:O,onChange:a=>P(a.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]}),(0,b.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>aq("all"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","all"!==ac||ag?"bg-white text-gray-600 border border-gray-200":"bg-emerald-100 text-emerald-700 border border-emerald-200"),children:[(0,b.jsx)(q.Package,{className:"w-4 h-4"}),"Tutti"]}),(0,b.jsxs)("button",{onClick:()=>aq("consumabile"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","consumabile"===ac?"bg-blue-100 text-blue-700 border border-blue-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,b.jsx)(r.Sparkles,{className:"w-4 h-4"}),"Pulizia","consumabile"===ae?(0,b.jsx)(u.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,b.jsx)(t.ChevronDown,{className:"w-3 h-3 ml-1"})]}),(0,b.jsxs)("button",{onClick:()=>aq("attrezzatura"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","attrezzatura"===ac?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,b.jsx)(s.Wrench,{className:"w-4 h-4"}),"Attrezz.","attrezzatura"===ae?(0,b.jsx)(u.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,b.jsx)(t.ChevronDown,{className:"w-3 h-3 ml-1"})]})]}),ae&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 animate-slide-up",children:g.CATEGORIES_BY_TYPE[ae].map(a=>(0,b.jsxs)("button",{onClick:()=>{ag===a?ah(null):ah(a)},className:(0,f.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",ag===a?"consumabile"===ae?"bg-blue-500 text-white":"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,b.jsx)("span",{children:g.CATEGORY_ICONS[a]}),g.CATEGORY_LABELS[a]]},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:O||"all"!==ac?"Risultati ricerca":K.length>0?"Caricati di recente":"Tutti i prodotti"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(O||"all"!==ac?ap.slice(0,15):K.length>0?K:ap.slice(0,10)).map(a=>(0,b.jsxs)("button",{onClick:()=>R(a),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-emerald-100",children:g.CATEGORY_ICONS[a.category]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,f.formatCurrency)(a.unit_cost),"/pz"]})]}),(0,b.jsx)("span",{className:"font-bold text-gray-900",children:(0,f.formatNumber)(a.current_stock,0)})]},a.id)),!O&&"all"===ac&&K.length>0&&(0,b.jsx)("button",{onClick:()=>P(" "),className:"w-full p-3 text-center text-emerald-600 font-medium text-sm hover:bg-emerald-50 rounded-xl transition-colors",children:"Mostra tutti i prodotti →"})]})]})]})]})}function C(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}),children:(0,b.jsx)(B,{})})}a.s(["default",()=>C])}];

//# sourceMappingURL=src_app_%28app%29_movimenti_carico_page_tsx_c49b927e._.js.map
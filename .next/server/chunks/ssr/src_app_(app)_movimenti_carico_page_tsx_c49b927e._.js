module.exports=[1286,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95445),e=a.i(64696),f=a.i(68114),g=a.i(39726),h=a.i(7484),i=a.i(87532),j=a.i(23025),k=a.i(15618),l=a.i(33441),m=a.i(96221),n=a.i(13513),o=a.i(33508),p=a.i(66384),q=a.i(83497),r=a.i(8406),s=a.i(79808),t=a.i(5784),u=a.i(67552),v=a.i(13749),w=a.i(47591),x=a.i(38246),y=a.i(50944);a.i(6051);var z=a.i(22909),A=a.i(49623),B=a.i(91345),C=a.i(38626);function D(){let a,{user:D,isManager:E,loading:F}=(0,e.useAuth)(),G=(0,y.useRouter)(),H=(0,y.useSearchParams)(),I=H.get("product"),J="movimenti"===H.get("from"),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!0),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(null),[ae,af]=(0,c.useState)("all"),[ag,ah]=(0,c.useState)(null),[ai,aj]=(0,c.useState)(null),ak=(0,c.useRef)(null),al=(0,c.useRef)(null),am=(0,d.createClient)(),[an,ao]=(0,c.useState)(null),ap=(0,C.useIsMobile)(),aq=(0,c.useCallback)(a=>{let b=K.find(b=>b.barcode===a);b?(T(b),ao(a),setTimeout(()=>ao(null),2e3)):(ad(`Prodotto non trovato: ${a}`),setTimeout(()=>ad(null),3e3))},[K]);(0,C.useBarcodeScanner)({onScan:aq,enabled:!S&&!aa&&K.length>0&&!ap,minLength:5}),(0,c.useEffect)(()=>{!F&&E&&G.replace("/")},[E,F,G]),(0,c.useEffect)(()=>{if(E)return;let a=!0;return(async()=>{try{let{products:b}=await ar();if(I&&b&&a){let a=b.find(a=>a.id===I);a&&T(a)}}finally{a&&P(!1)}})(),()=>{a=!1,au()}},[I,D?.id,E]);let ar=async()=>{let{data:a}=await am.from("products").select("*").eq("is_active",!0).order("name");a&&L(a);let b=[];if(D?.id&&a){let c=new Date;c.setDate(c.getDate()-30);let{data:d}=await am.from("movements").select("product_id, created_at").eq("operator_id",D.id).eq("type","carico").gte("created_at",c.toISOString()).order("created_at",{ascending:!1});if(d&&d.length>0){let c=new Set,e=[];for(let a of d)c.has(a.product_id)||(c.add(a.product_id),e.push(a.product_id));let f=new Map(a.map(a=>[a.id,a]));b=e.map(a=>f.get(a)).filter(a=>void 0!==a).slice(0,10)}}return N(b),{products:a,recentProducts:b}},as=(0,c.useCallback)(a=>{let b=K.find(b=>b.barcode===a);b?(T(b),au()):(ad(`Prodotto non trovato: ${a}`),setTimeout(()=>ad(null),3e3))},[K]),at=async()=>{ab(!0),ad(null);try{let a=new Map;a.set(B.DecodeHintType.POSSIBLE_FORMATS,[A.BarcodeFormat.EAN_13,A.BarcodeFormat.EAN_8,A.BarcodeFormat.CODE_128,A.BarcodeFormat.CODE_39,A.BarcodeFormat.UPC_A,A.BarcodeFormat.UPC_E,A.BarcodeFormat.QR_CODE]);let b=new z.BrowserMultiFormatReader(a);al.current=b;let c=await b.listVideoInputDevices(),d=c[0]?.deviceId,e=c.find(a=>a.label.toLowerCase().includes("back")||a.label.toLowerCase().includes("rear")||a.label.toLowerCase().includes("environment"));if(e&&(d=e.deviceId),!d)throw Error("Nessuna fotocamera trovata");await b.decodeFromVideoDevice(d,ak.current,a=>{if(a){let b=a.getText();console.log("Barcode detected:",b),as(b)}})}catch(a){console.error("Scanner error:",a),ad("Impossibile accedere alla fotocamera"),ab(!1)}},au=(0,c.useCallback)(()=>{al.current&&(al.current.reset(),al.current=null),ab(!1),ad(null)},[]),av=(a=K,ai?a=K.filter(a=>a.category===ai):"all"!==ae&&(a=(0,g.filterProductsByType)(K,ae)),a.filter(a=>a.name.toLowerCase().includes(Q.toLowerCase())||a.barcode?.toLowerCase().includes(Q.toLowerCase()))),aw=a=>{"all"===a?(af("all"),ah(null),aj(null)):ag===a?(ah(null),aj(null),af(a)):(af(a),ah(a),aj(null))},ax=async()=>{if(S&&D){X(!0);try{let{error:a}=await am.from("movements").insert({type:"carico",product_id:S.id,quantity:U,unit_cost_at_time:S.unit_cost,operator_id:D.id});if(a)throw a;_({product:S.name,quantity:U,total:U*S.unit_cost,newStock:S.current_stock+U}),Z(!0),T(null),V(1),R("")}catch(a){console.error("Error:",a),alert("Errore durante il carico")}finally{X(!1)}}};return F?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)(m.Loader2,{className:"w-8 h-8 text-emerald-600 animate-spin"})}):E?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:(0,b.jsx)(p.ShieldAlert,{className:"w-8 h-8 text-red-600"})}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Accesso Negato"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Non hai i permessi per accedere ai movimenti."}),(0,b.jsx)("button",{onClick:()=>G.push("/"),className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-medium",children:"Torna alla Home"})]}):O?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}):Y&&$?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm",children:"Operazione completata"})]})]})}),(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-8 text-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(l.Check,{className:"w-10 h-10 text-emerald-600"})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Carico Registrato!"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:["+",$.quantity,"x ",$.product]}),(0,b.jsxs)("p",{className:"text-lg text-gray-700",children:["Nuova giacenza: ",(0,b.jsx)("span",{className:"font-bold text-emerald-600",children:$.newStock})]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-emerald-600 mt-2",children:(0,f.formatCurrency)($.total)}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,b.jsx)("button",{onClick:()=>{Z(!1),_(null),ar()},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] w-full",children:"Nuovo Carico"}),(0,b.jsx)("button",{onClick:()=>G.push("/movimenti"),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 w-full",children:"Vai a Movimenti"})]})]})})]}):S?(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm truncate",children:S.name})]})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Prodotto"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center text-2xl",children:g.CATEGORY_ICONS[S.category]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:S.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,f.formatCurrency)(S.unit_cost),"/pz • Giacenza attuale: ",(0,f.formatNumber)(S.current_stock,0)]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-4",children:"Quantità da Caricare"}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,b.jsx)("button",{onClick:()=>V(Math.max(1,U-1)),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-red-100 text-red-600 hover:bg-red-200",children:(0,b.jsx)(j.Minus,{className:"w-6 h-6"})}),(0,b.jsx)("span",{className:"text-5xl font-bold text-gray-900 w-20 text-center",children:U}),(0,b.jsx)("button",{onClick:()=>V(U+1),className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl font-bold transition-all duration-200 active:scale-95 bg-emerald-100 text-emerald-600 hover:bg-emerald-200",children:(0,b.jsx)(k.Plus,{className:"w-6 h-6"})})]}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Valore: ",(0,b.jsx)("span",{className:"font-semibold text-emerald-600",children:(0,f.formatCurrency)(U*S.unit_cost)})]})})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{onClick:()=>{T(null),V(1)},className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50 focus:ring-gray-500 flex-1",children:"Annulla"}),(0,b.jsx)("button",{onClick:ax,disabled:W,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 focus:ring-emerald-500 shadow-md hover:shadow-lg active:scale-[0.98] flex-1",children:W?(0,b.jsx)(m.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Check,{className:"w-5 h-5"}),"Conferma"]})})]})]})]}):(0,b.jsxs)("div",{className:"min-h-screen",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 text-white px-4 pt-12 pb-6 rounded-b-3xl",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-3",children:[(0,b.jsx)(x.default,{href:J?"/movimenti":"/",className:"p-2 -ml-2 hover:bg-white/10 rounded-xl transition-colors",children:(0,b.jsx)(v.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)(h.ArrowDownToLine,{className:"w-6 h-6"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Carico Merce"}),(0,b.jsx)("p",{className:"text-emerald-100 text-sm",children:"Scansiona o cerca prodotto"})]})]})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 -mt-4 space-y-4",children:[!ap&&(0,b.jsxs)("div",{className:(0,f.cn)("flex items-center gap-3 p-4 rounded-2xl border-2 transition-all",an?"bg-emerald-50 border-emerald-500":"bg-blue-50 border-blue-200"),children:[(0,b.jsx)("div",{className:(0,f.cn)("w-10 h-10 rounded-xl flex items-center justify-center",an?"bg-emerald-500 text-white":"bg-blue-500 text-white"),children:(0,b.jsx)(w.ScanBarcode,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:an?"Barcode rilevato!":"Pistola barcode pronta"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:an||"Scansiona un prodotto con la pistola USB"})]}),an&&(0,b.jsx)(l.Check,{className:"w-6 h-6 text-emerald-500"})]}),ap&&(aa?(0,b.jsxs)("div",{className:"relative h-48 bg-gray-900 rounded-2xl overflow-hidden",children:[(0,b.jsx)("video",{ref:ak,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-32 h-32 border-2 border-cyan-400 rounded-xl relative",children:(0,b.jsx)("div",{className:"scanner-line"})})}),ac&&(0,b.jsx)("div",{className:"absolute bottom-3 left-3 right-3 bg-red-500 text-white text-sm px-3 py-2 rounded-lg text-center",children:ac}),(0,b.jsx)("button",{onClick:au,className:"absolute top-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center",children:(0,b.jsx)(o.X,{className:"w-4 h-4 text-white"})}),(0,b.jsx)("div",{className:"absolute top-3 left-3 bg-black/50 text-white text-xs px-2 py-1 rounded",children:"Inquadra il barcode"})]}):(0,b.jsxs)("button",{onClick:at,className:"w-full h-32 bg-gray-800 rounded-2xl flex flex-col items-center justify-center gap-2 text-gray-400 hover:bg-gray-700 transition-colors",children:[(0,b.jsx)(n.Camera,{className:"w-8 h-8"}),(0,b.jsx)("span",{className:"text-sm",children:"Tocca per scansionare barcode"})]})),(0,b.jsxs)("div",{children:[ap&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Oppure cerca manualmente"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Nome prodotto o barcode...",value:Q,onChange:a=>R(a.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-900 placeholder-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-12"})]}),(0,b.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>aw("all"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","all"!==ae||ai?"bg-white text-gray-600 border border-gray-200":"bg-emerald-100 text-emerald-700 border border-emerald-200"),children:[(0,b.jsx)(q.Package,{className:"w-4 h-4"}),"Tutti"]}),(0,b.jsxs)("button",{onClick:()=>aw("consumabile"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","consumabile"===ae?"bg-blue-100 text-blue-700 border border-blue-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,b.jsx)(r.Sparkles,{className:"w-4 h-4"}),"Pulizia","consumabile"===ag?(0,b.jsx)(u.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,b.jsx)(t.ChevronDown,{className:"w-3 h-3 ml-1"})]}),(0,b.jsxs)("button",{onClick:()=>aw("attrezzatura"),className:(0,f.cn)("flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all","attrezzatura"===ae?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200"),children:[(0,b.jsx)(s.Wrench,{className:"w-4 h-4"}),"Attrezz.","attrezzatura"===ag?(0,b.jsx)(u.ChevronUp,{className:"w-3 h-3 ml-1"}):(0,b.jsx)(t.ChevronDown,{className:"w-3 h-3 ml-1"})]})]}),ag&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 animate-slide-up",children:g.CATEGORIES_BY_TYPE[ag].map(a=>(0,b.jsxs)("button",{onClick:()=>{ai===a?aj(null):aj(a)},className:(0,f.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",ai===a?"consumabile"===ag?"bg-blue-500 text-white":"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,b.jsx)("span",{children:g.CATEGORY_ICONS[a]}),g.CATEGORY_LABELS[a]]},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:Q||"all"!==ae?"Risultati ricerca":M.length>0?"Caricati di recente":"Tutti i prodotti"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(Q||"all"!==ae?av.slice(0,15):M.length>0?M:av.slice(0,10)).map(a=>(0,b.jsxs)("button",{onClick:()=>T(a),className:"flex items-center gap-4 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md hover:border-gray-200 w-full text-left",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-emerald-100",children:g.CATEGORY_ICONS[a.category]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 truncate",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,f.formatCurrency)(a.unit_cost),"/pz"]})]}),(0,b.jsx)("span",{className:"font-bold text-gray-900",children:(0,f.formatNumber)(a.current_stock,0)})]},a.id)),!Q&&"all"===ae&&M.length>0&&(0,b.jsx)("button",{onClick:()=>R(" "),className:"w-full p-3 text-center text-emerald-600 font-medium text-sm hover:bg-emerald-50 rounded-xl transition-colors",children:"Mostra tutti i prodotti →"})]})]})]})]})}function E(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}),children:(0,b.jsx)(D,{})})}a.s(["default",()=>E])}];

//# sourceMappingURL=src_app_%28app%29_movimenti_carico_page_tsx_c49b927e._.js.map
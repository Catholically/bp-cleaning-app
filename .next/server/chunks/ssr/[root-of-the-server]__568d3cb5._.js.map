{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../src/components/providers/auth-provider.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client'\n\nimport { createContext, useContext, useEffect, useState, useRef } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport type { User } from '@supabase/supabase-js'\nimport type { Profile } from '@/lib/types'\n\ninterface AuthContextType {\n  user: User | null\n  profile: Profile | null\n  loading: boolean\n  isSuperuser: boolean\n  isManager: boolean\n  isManagerOrSuperuser: boolean\n  signOut: () => Promise<void>\n  refreshProfile: () => Promise<void>\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  user: null,\n  profile: null,\n  loading: true,\n  isSuperuser: false,\n  isManager: false,\n  isManagerOrSuperuser: false,\n  signOut: async () => {},\n  refreshProfile: async () => {}\n})\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [loading, setLoading] = useState(true)\n  const supabaseRef = useRef(createClient())\n  const supabase = supabaseRef.current\n\n  const fetchProfile = async (userId: string) => {\n    const { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', userId)\n      .single()\n    \n    if (error) {\n      console.error('Error fetching profile:', error)\n      return null\n    }\n    return data as Profile\n  }\n\n  const refreshProfile = async () => {\n    if (user) {\n      const profile = await fetchProfile(user.id)\n      setProfile(profile)\n    }\n  }\n\n  useEffect(() => {\n    let mounted = true\n\n    // Use getSession first (reads from local storage, faster)\n    // Then onAuthStateChange will handle token refresh if needed\n    const initAuth = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession()\n\n        if (!mounted) return\n\n        if (error || !session) {\n          setUser(null)\n          setProfile(null)\n          setLoading(false)\n          return\n        }\n\n        setUser(session.user)\n\n        // Fetch profile in background, don't block loading\n        fetchProfile(session.user.id).then(profile => {\n          if (mounted) setProfile(profile)\n        })\n\n        setLoading(false)\n      } catch (error) {\n        console.error('Auth init error:', error)\n        if (mounted) {\n          setUser(null)\n          setProfile(null)\n          setLoading(false)\n        }\n      }\n    }\n\n    initAuth()\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event: any, session: any) => {\n        if (!mounted) return\n\n        if (session?.user) {\n          setUser(session.user)\n          // Fetch profile in background\n          fetchProfile(session.user.id).then(profile => {\n            if (mounted) setProfile(profile)\n          })\n        } else {\n          setUser(null)\n          setProfile(null)\n        }\n\n        setLoading(false)\n      }\n    )\n\n    return () => {\n      mounted = false\n      subscription.unsubscribe()\n    }\n  }, [])\n\n  const signOut = async () => {\n    await supabase.auth.signOut()\n    setUser(null)\n    setProfile(null)\n    // Force redirect to avoid state issues\n    window.location.href = '/login'\n  }\n\n  const isSuperuser = profile?.role === 'superuser'\n  const isManager = profile?.role === 'manager'\n  const isManagerOrSuperuser = isSuperuser || isManager\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      profile,\n      loading,\n      isSuperuser,\n      isManager,\n      isManagerOrSuperuser,\n      signOut,\n      refreshProfile\n    }}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport const useAuth = () => useContext(AuthContext)\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"0NA0BQG,EAAOC,OAAO,CAAGC,EAAQ,CAAA,CAAA,IAAA,iCC1BjCF,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEC,eAAe,+BCFxCP,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEE,KAAK,0CCA9B,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAeA,IAAM,EAAc,CAAA,EAAA,EAAA,aAAA,AAAa,EAAkB,CACjD,KAAM,KACN,QAAS,KACT,QAAS,GACT,aAAa,EACb,WAAW,EACX,sBAAsB,EACtB,QAAS,UAAa,EACtB,eAAgB,UAAa,CAC/B,GAEO,SAAS,EAAa,UAAE,CAAQ,CAAiC,EACtE,GAAM,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACxC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAiB,MACjD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEjC,EADc,AACH,CADG,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,YAAA,AAAY,KACV,OAAO,CAE9B,EAAe,MAAO,IAC1B,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,GACT,MAAM,UAET,AAAI,GACF,IADS,IACD,KAAK,CAAC,0BAA2B,GAClC,MAEF,CACT,EAEM,EAAiB,UACjB,GAEF,EADgB,CADR,KACc,EAAa,CACxB,CAD6B,EAAE,EAG9C,EAEA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAI,GAAU,EAmCd,CA/BiB,UACf,GAAI,CACF,GAAM,CAAE,KAAM,SAAE,CAAO,CAAE,OAAE,CAAK,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,UAAU,GAEnE,GAAI,CAAC,EAAS,OAEd,GAAI,GAAS,CAAC,EAAS,CACrB,EAAQ,MACR,EAAW,MACX,GAAW,GACX,MACF,CAEA,EAAQ,EAAQ,IAAI,EAGpB,EAAa,EAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,IAC7B,GAAS,EAAW,EAC1B,GAEA,GAAW,EACb,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,mBAAoB,GAC9B,IACF,EAAQ,GADG,GAEX,EAAW,MACX,GAAW,GAEf,EACF,IAIA,GAAM,CAAE,KAAM,cAAE,CAAY,CAAE,CAAE,CAAG,EAAS,IAAI,CAAC,iBAAiB,CAChE,MAAO,EAAY,KACZ,IAED,GAAS,EAFC,IAEK,AACjB,EAAQ,EAAQ,IAAI,EAEpB,EAAa,EAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,IAC7B,GAAS,EAAW,EAC1B,KAEA,EAAQ,MACR,EAAW,OAGb,GAAW,GACb,GAGF,MAAO,KACL,EAAU,GACV,EAAa,WAAW,EAC1B,CACF,EAAG,EAAE,EAEL,IAAM,EAAU,UACd,MAAM,EAAS,IAAI,CAAC,OAAO,GAC3B,EAAQ,MACR,EAAW,MAEX,OAAO,QAAQ,CAAC,IAAI,CAAG,QACzB,EAEM,EAAc,GAAS,OAAS,YAChC,EAAY,GAAS,OAAS,UAC9B,EAAuB,GAAe,EAE5C,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAY,QAAQ,CAAA,CAAC,MAAO,MAC3B,UACA,UACA,cACA,YACA,uBACA,UACA,iBACA,CACF,WACG,GAGP,uCAEuB,IAAM,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC","ignoreList":[0,1,2]}